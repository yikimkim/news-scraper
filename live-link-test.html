<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§í¬ ê¸°ëŠ¥ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .url-display { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; margin: 10px 0; word-break: break-all; }
        .test-card { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 8px; background: white; }
        .government-news-card { background: #f8f9fa; border: 1px solid #007bff; }
        .news-card { background: #fff8dc; border: 1px solid #ffa500; }
    </style>
</head>
<body>
    <h1>ğŸ” ë§í¬ ê¸°ëŠ¥ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸</h1>
    <p><strong>ëª©ì :</strong> ì‚¬ìš©ìê°€ ë³´ê³ í•˜ëŠ” "ì›ë¬¸ ë³´ê¸°"ì™€ "ìì„¸íˆ ì½ê¸°" ë²„íŠ¼ì˜ ì‹¤ì œ ë™ì‘ì„ í™•ì¸</p>

    <div class="test-section">
        <h2>ğŸ›ï¸ ì •ë¶€ ë³´ë„ìë£Œ ì¹´ë“œ í…ŒìŠ¤íŠ¸</h2>
        <p>í˜„ì¬ ì½”ë“œì—ì„œ ì‹¤ì œë¡œ ìƒì„±ë˜ëŠ” ì •ë¶€ ë³´ë„ìë£Œ ì¹´ë“œ</p>
        
        <div class="test-card government-news-card">
            <div class="news-content">
                <div class="news-header">
                    <span class="news-source">ê¸ˆìœµìœ„ì›íšŒ</span>
                    <span class="news-date">2024-10-15</span>
                </div>
                <h4 class="news-title clickable-title">ë””ì§€í„¸ ìì‚° ê·œì œ ë°©ì•ˆ ë°œí‘œ - 10ì›” 15ì¼</h4>
                <p class="news-summary">ê¸ˆìœµìœ„ì›íšŒê°€ ë””ì§€í„¸ ìì‚°ì˜ ê±´ì „í•œ ìœ¡ì„±ì„ ìœ„í•œ ìƒˆë¡œìš´ ê·œì œ ë°©ì•ˆì„ ë°œí‘œí–ˆìŠµë‹ˆë‹¤.</p>
                <div class="news-footer">
                    <a href="#" class="news-link" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); testGovernmentLink(event)">ğŸ“– ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸°</a>
                    <button class="save-btn" onclick="event.stopPropagation(); alert('ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸')" title="ì €ì¥">ğŸ’¾</button>
                </div>
            </div>
        </div>
        
        <div id="gov-url-result" class="url-display"></div>
    </div>

    <div class="test-section">
        <h2>âš¡ ë¹ ë¥¸ ê²€ìƒ‰ ì¹´ë“œ í…ŒìŠ¤íŠ¸</h2>
        <p>í˜„ì¬ ì½”ë“œì—ì„œ ì‹¤ì œë¡œ ìƒì„±ë˜ëŠ” ë¹ ë¥¸ ê²€ìƒ‰ ì¹´ë“œ</p>
        
        <div class="test-card news-card">
            <button class="save-btn" onclick="event.stopPropagation(); alert('ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸')" title="ê¸°ì‚¬ ì €ì¥">ğŸ’¾</button>
            <img src="https://via.placeholder.com/300x200?text=No+Image" alt="ë‰´ìŠ¤ ì´ë¯¸ì§€" style="width: 100%; height: 150px; object-fit: cover;">
            <div class="news-card-content">
                <div class="news-meta">
                    <span>ì—°í•©ë‰´ìŠ¤</span>
                    <span>2024-10-15</span>
                </div>
                <h3 class="clickable-title">ë””ì§€í„¸ ìì‚° íˆ¬ìì ë³´í˜¸ ê°•í™” ë°©ì•ˆ ë…¼ì˜</h3>
                <p>ê¸ˆìœµë‹¹êµ­ì´ ë””ì§€í„¸ ìì‚° íˆ¬ìì ë³´í˜¸ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ê·œì œ ë°©ì•ˆì„ ê²€í† í•˜ê³  ìˆë‹¤ê³  ë°œí‘œí–ˆìŠµë‹ˆë‹¤.</p>
                <a href="#" class="news-link" target="_blank" onclick="event.stopPropagation(); testQuickSearchLink(event)">ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸° â†’</a>
            </div>
        </div>
        
        <div id="quick-url-result" class="url-display"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”— URL ìƒì„± í•¨ìˆ˜ ì§ì ‘ í…ŒìŠ¤íŠ¸</h2>
        
        <button class="button" onclick="testGenerateArticleUrl()">ì •ë¶€ ë³´ë„ìë£Œ URL ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <button class="button" onclick="testGenerateQuickSearchUrl()">ë¹ ë¥¸ ê²€ìƒ‰ URL ìƒì„± í…ŒìŠ¤íŠ¸</button>
        
        <div id="function-test-results"></div>
    </div>

    <div class="test-section">
        <h2>â“ ì‚¬ìš©ì ë³´ê³  ì‚¬í•­ í™•ì¸</h2>
        <p>ì‚¬ìš©ìê°€ ì–¸ê¸‰í•œ "ì›ë¬¸ ë³´ê¸°"ì™€ "ìì„¸íˆ ì½ê¸°" ë²„íŠ¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
        <p><strong>í˜„ì¬ ì½”ë“œì˜ ì‹¤ì œ ë²„íŠ¼ í…ìŠ¤íŠ¸:</strong></p>
        <ul>
            <li>ì •ë¶€ ë³´ë„ìë£Œ: "ğŸ“– ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸°"</li>
            <li>ë¹ ë¥¸ ê²€ìƒ‰: "ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸° â†’"</li>
        </ul>
        <p><strong>ê°€ëŠ¥í•œ ì›ì¸:</strong></p>
        <ul>
            <li>ë‹¤ë¥¸ ë²„ì „ì˜ ì½”ë“œê°€ ì‹¤í–‰ ì¤‘ì¼ ìˆ˜ ìˆìŒ</li>
            <li>ìºì‹œëœ ì´ì „ ë²„ì „ì„ ë³´ê³  ìˆì„ ìˆ˜ ìˆìŒ</li>
            <li>ë°±ì—”ë“œ API í¬íŠ¸ ë¬¸ì œ (í˜„ì¬ 3001 í¬íŠ¸ ì‚¬ìš©)</li>
        </ul>
    </div>

    <script>
        // ì •ë¶€ ë³´ë„ìë£Œ URL ìƒì„± í•¨ìˆ˜ (index.htmlì—ì„œ ë³µì‚¬)
        function generateArticleUrl(item) {
            // ê¸°ì¡´ URLì´ ê°œë³„ ë³´ë„ìë£Œë¥¼ ì§€ì‹œí•˜ëŠ” ê²½ìš° (ì˜ˆ: view.do, Detail.do í¬í•¨)
            if (item.url && (item.url.includes('view.do') || item.url.includes('Detail.do') || item.url.includes('/view/') || item.url.includes('/detail/'))) {
                return item.url;
            }
            
            // ì œëª©ì—ì„œ í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ
            const titleKeywords = item.title.replace(/- \d+ì›” \d+ì¼$/, '').trim().split(' ');
            const mainKeyword = titleKeywords[0] || 'ë³´ë„ìë£Œ';
            
            // ë‚ ì§œ ì •ë³´ ì¶”ì¶œ (publishedAt ë˜ëŠ” ì œëª©ì—ì„œ)
            let searchDate = '';
            if (item.publishedAt) {
                const date = new Date(item.publishedAt);
                searchDate = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            }
            
            // ê¸°ê´€ë³„ ê²€ìƒ‰ URL ìƒì„± (ë” ì •í™•í•œ ê²€ìƒ‰ì„ ìœ„í•´)
            let searchUrl;
            const encodedKeyword = encodeURIComponent(mainKeyword);
            const encodedAgency = encodeURIComponent(item.agency);
            const encodedDate = encodeURIComponent(searchDate);
            
            switch (item.agencyCode) {
                case 'fsc':
                    // ê¸ˆìœµìœ„ì›íšŒ ì‚¬ì´íŠ¸ ë‚´ ê²€ìƒ‰ + ë„¤ì´ë²„ ê²€ìƒ‰ ì¡°í•©
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fsc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                    
                case 'fss':
                    // ê¸ˆìœµê°ë…ì› ì‚¬ì´íŠ¸ ë‚´ ê²€ìƒ‰ + ë„¤ì´ë²„ ê²€ìƒ‰ ì¡°í•©
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fss.or.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                    
                case 'ftc':
                    // ê³µì •ê±°ë˜ìœ„ì›íšŒ ì‚¬ì´íŠ¸ ë‚´ ê²€ìƒ‰ + ë„¤ì´ë²„ ê²€ìƒ‰ ì¡°í•©
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:ftc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                    
                default:
                    // ê¸°ë³¸ ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰
                    searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}&sort=1`;
            }
            
            return searchUrl;
        }
        
        // ë¹ ë¥¸ ê²€ìƒ‰ìš© ê°œì„ ëœ URL ìƒì„± í•¨ìˆ˜
        function generateQuickSearchUrl(article, searchKeyword) {
            // ê¸°ì¡´ URLì´ ì´ë¯¸ ì§ì ‘ ê¸°ì‚¬ ë§í¬ì¸ ê²½ìš°
            if (article.url && (article.url.includes('news.naver.com/main/read') || article.url.includes('/article/') || article.url.includes('/view/'))) {
                return article.url;
            }
            
            // ì œëª©ì—ì„œ í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ (ë¶€ì œëª© ì œê±°)
            let cleanTitle = article.title.replace(/ - .*$/, '').trim(); // ë¶€ì œëª© ì œê±°
            cleanTitle = cleanTitle.replace(/\.\.\..*$/, '').trim(); // ìƒëµ ë¶€ë¶„ ì œê±°
            
            // ì œëª©ì˜ ì£¼ìš” í‚¤ì›Œë“œ ì¶”ì¶œ (2-3ê°œ ì£¼ìš” ë‹¨ì–´)
            const titleWords = cleanTitle.split(' ').filter(word => word.length > 1); // 1ê¸€ì ë‹¨ì–´ ì œì™¸
            const keyTitleWords = titleWords.slice(0, 3).join(' '); // ì£¼ìš” 3ê°œ ë‹¨ì–´
            
            // ë‚ ì§œ ì •ë³´ ì¶”ì¶œ
            let searchDate = '';
            if (article.publishedAt) {
                try {
                    // ë‹¤ì–‘í•œ ë‚ ì§œ í˜•ì‹ ì§€ì›
                    let dateObj;
                    if (typeof article.publishedAt === 'string') {
                        // 'ì— ëŒ€í•œ ìƒì„¸ ì •ë³´'ë¥¼ ì œê±°í•˜ê³  ë‚ ì§œë§Œ ì¶”ì¶œ
                        const dateStr = article.publishedAt.replace(/ì— ëŒ€í•œ .*$/, '').trim();
                        dateObj = new Date(dateStr);
                    } else {
                        dateObj = new Date(article.publishedAt);
                    }
                    
                    if (!isNaN(dateObj.getTime())) {
                        searchDate = `${dateObj.getFullYear()}.${String(dateObj.getMonth() + 1).padStart(2, '0')}.${String(dateObj.getDate()).padStart(2, '0')}`;
                    }
                } catch (error) {
                    console.warn('ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜:', error);
                }
            }
            
            // ê²€ìƒ‰ ì „ëµ: ì›ë˜ ê²€ìƒ‰ í‚¤ì›Œë“œ + ì œëª© í‚¤ì›Œë“œ + ë‚ ì§œ
            const searchParts = [];
            
            // 1. ì›ë˜ ê²€ìƒ‰ í‚¤ì›Œë“œ ì¶”ê°€
            if (searchKeyword && searchKeyword.trim()) {
                searchParts.push(searchKeyword.trim());
            }
            
            // 2. ì œëª©ì˜ í•µì‹¬ í‚¤ì›Œë“œ ì¶”ê°€
            if (keyTitleWords && keyTitleWords !== searchKeyword) {
                searchParts.push(keyTitleWords);
            }
            
            // 3. ë‚ ì§œ ì •ë³´ ì¶”ê°€ (ì„ íƒì )
            if (searchDate) {
                searchParts.push(searchDate);
            }
            
            // ìµœì¢… ê²€ìƒ‰ ì¿¼ë¦¬ ìƒì„±
            const finalSearchQuery = searchParts.join(' ').trim();
            
            // ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ URL ìƒì„± (ìµœì‹ ìˆœ ì •ë ¬)
            const searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodeURIComponent(finalSearchQuery)}&sort=1`;
            
            console.log(`ë¹ ë¥¸ ê²€ìƒ‰ URL ìƒì„±: "${article.title}" -> "${finalSearchQuery}"`);
            return searchUrl;
        }

        function testGovernmentLink(event) {
            event.preventDefault();
            
            const testItem = {
                title: "ë””ì§€í„¸ ìì‚° ê·œì œ ë°©ì•ˆ ë°œí‘œ - 10ì›” 15ì¼",
                agency: "ê¸ˆìœµìœ„ì›íšŒ", 
                agencyCode: "fsc",
                publishedAt: "2024-10-15"
            };
            
            const generatedUrl = generateArticleUrl(testItem);
            
            document.getElementById('gov-url-result').innerHTML = `
                <strong>ìƒì„±ëœ URL:</strong><br>
                <a href="${generatedUrl}" target="_blank">${generatedUrl}</a>
            `;
            
            console.log('ì •ë¶€ ë³´ë„ìë£Œ URL ìƒì„±:', generatedUrl);
            
            // ì‹¤ì œë¡œ ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
            window.open(generatedUrl, '_blank');
        }

        function testQuickSearchLink(event) {
            event.preventDefault();
            
            const testArticle = {
                title: "ë””ì§€í„¸ ìì‚° íˆ¬ìì ë³´í˜¸ ê°•í™” ë°©ì•ˆ ë…¼ì˜",
                publishedAt: "2024-10-15"
            };
            
            const generatedUrl = generateQuickSearchUrl(testArticle, "ë””ì§€í„¸ìì‚°");
            
            document.getElementById('quick-url-result').innerHTML = `
                <strong>ìƒì„±ëœ URL:</strong><br>
                <a href="${generatedUrl}" target="_blank">${generatedUrl}</a>
            `;
            
            console.log('ë¹ ë¥¸ ê²€ìƒ‰ URL ìƒì„±:', generatedUrl);
            
            // ì‹¤ì œë¡œ ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
            window.open(generatedUrl, '_blank');
        }

        function testGenerateArticleUrl() {
            const testCases = [
                {
                    title: "ë””ì§€í„¸ ìì‚° ê·œì œ ë°©ì•ˆ ë°œí‘œ - 10ì›” 15ì¼",
                    agency: "ê¸ˆìœµìœ„ì›íšŒ",
                    agencyCode: "fsc",
                    publishedAt: "2024-10-15"
                },
                {
                    title: "ê¸ˆìœµì†Œë¹„ì ë³´í˜¸ ê°•í™” ë°©ì•ˆ",
                    agency: "ê¸ˆìœµê°ë…ì›", 
                    agencyCode: "fss",
                    publishedAt: "2024-10-14"
                },
                {
                    title: "ë…ì ê·œì œ ë° ê³µì •ê±°ë˜ì— ê´€í•œ ë²•ë¥  ê°œì •ì•ˆ",
                    agency: "ê³µì •ê±°ë˜ìœ„ì›íšŒ",
                    agencyCode: "ftc", 
                    publishedAt: "2024-10-13"
                }
            ];
            
            let resultHTML = '<h3>ì •ë¶€ ë³´ë„ìë£Œ URL ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h3>';
            
            testCases.forEach((testCase, index) => {
                const url = generateArticleUrl(testCase);
                resultHTML += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc;">
                        <strong>í…ŒìŠ¤íŠ¸ ${index + 1}:</strong> ${testCase.title}<br>
                        <strong>ê¸°ê´€:</strong> ${testCase.agency}<br>
                        <strong>ìƒì„±ëœ URL:</strong> <a href="${url}" target="_blank">${url}</a>
                    </div>
                `;
            });
            
            document.getElementById('function-test-results').innerHTML = resultHTML;
        }

        function testGenerateQuickSearchUrl() {
            const testCases = [
                {
                    article: { title: "ë””ì§€í„¸ ìì‚° íˆ¬ìì ë³´í˜¸ ê°•í™” ë°©ì•ˆ ë…¼ì˜", publishedAt: "2024-10-15" },
                    keyword: "ë””ì§€í„¸ìì‚°"
                },
                {
                    article: { title: "ê¸ˆìœµí˜ì‹  ì§€ì› íŠ¹ë³„ë²• ì‹œí–‰ë ¹ ê°œì •", publishedAt: "2024-10-14" },
                    keyword: "ê¸ˆìœµí˜ì‹ "
                },
                {
                    article: { title: "ë¶€ë™ì‚° ì‹œì¥ ì•ˆì •í™” ëŒ€ì±… ë°œí‘œ", publishedAt: "2024-10-13" },
                    keyword: "ë¶€ë™ì‚°"
                }
            ];
            
            let resultHTML = '<h3>ë¹ ë¥¸ ê²€ìƒ‰ URL ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h3>';
            
            testCases.forEach((testCase, index) => {
                const url = generateQuickSearchUrl(testCase.article, testCase.keyword);
                resultHTML += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc;">
                        <strong>í…ŒìŠ¤íŠ¸ ${index + 1}:</strong> ${testCase.article.title}<br>
                        <strong>ê²€ìƒ‰ í‚¤ì›Œë“œ:</strong> ${testCase.keyword}<br>
                        <strong>ìƒì„±ëœ URL:</strong> <a href="${url}" target="_blank">${url}</a>
                    </div>
                `;
            });
            
            document.getElementById('function-test-results').innerHTML = resultHTML;
        }
    </script>
</body>
</html>