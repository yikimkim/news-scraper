<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”— ë³´ë„ìë£Œ ë§í¬ ê°œì„  í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .url-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .url-box {
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            word-break: break-all;
        }
        .old-url {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .new-url {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .test-result {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
        }
        button:hover {
            background: #0056b3;
        }
        .demo-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .demo-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”— ë³´ë„ìë£Œ ë§í¬ ê°œì„  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
        <p>ê¸°ì¡´ ê²Œì‹œíŒ ë§í¬ vs ê°œì„ ëœ ì§ì ‘ ê²€ìƒ‰ ë§í¬ ë¹„êµ í…ŒìŠ¤íŠ¸</p>
    </div>

    <div class="test-section">
        <h3>ğŸ¯ ê°œì„ ì‚¬í•­ ìš”ì•½</h3>
        <ul>
            <li><strong>ê¸°ì¡´ ë¬¸ì œ</strong>: ì›ë¬¸ ë³´ê¸° í´ë¦­ â†’ ê²Œì‹œíŒ ë©”ì¸ í˜ì´ì§€ â†’ ìˆ˜ë™ìœ¼ë¡œ í•´ë‹¹ ë³´ë„ìë£Œ ì°¾ê¸°</li>
            <li><strong>ê°œì„  ë°©ì•ˆ</strong>: ì›ë¬¸ ë³´ê¸° í´ë¦­ â†’ ë°”ë¡œ ê´€ë ¨ ê¸°ì‚¬ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì´ë™</li>
            <li><strong>ê¸°ìˆ ì  êµ¬í˜„</strong>: ì œëª© í‚¤ì›Œë“œ + ë‚ ì§œ + ê¸°ê´€ëª…ìœ¼ë¡œ ì •í™•í•œ ê²€ìƒ‰ ì¿¼ë¦¬ ìƒì„±</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>ğŸ”„ ì‹¤ì‹œê°„ URL ìƒì„± í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testUrlGeneration()">URL ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="url-test-result"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“Š ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="loadRealDataTest()">ì‹¤ì œ ë³´ë„ìë£Œ ë°ì´í„° í…ŒìŠ¤íŠ¸</button>
        <div id="real-data-test"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ–±ï¸ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸</h3>
        <p>ì•„ë˜ ì¹´ë“œë“¤ì„ í´ë¦­í•´ë³´ì„¸ìš”. ìƒˆ íƒ­ì—ì„œ ê´€ë ¨ ê¸°ì‚¬ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—´ë¦´ ê²ƒì…ë‹ˆë‹¤:</p>
        <div id="demo-cards"></div>
    </div>

    <script>
        // ê°œì„ ëœ URL ìƒì„± í•¨ìˆ˜ (ë©”ì¸ ì•±ê³¼ ë™ì¼)
        function generateArticleUrl(item) {
            // ê¸°ì¡´ URLì´ ê°œë³„ ë³´ë„ìë£Œë¥¼ ì§€ì‹œí•˜ëŠ” ê²½ìš°
            if (item.url && (item.url.includes('view.do') || item.url.includes('Detail.do') || item.url.includes('/view/') || item.url.includes('/detail/'))) {
                return item.url;
            }
            
            // ì œëª©ì—ì„œ í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ
            const titleKeywords = item.title.replace(/- \d+ì›” \d+ì¼$/, '').trim().split(' ');
            const mainKeyword = titleKeywords[0] || 'ë³´ë„ìë£Œ';
            
            // ë‚ ì§œ ì •ë³´ ì¶”ì¶œ
            let searchDate = '';
            if (item.publishedAt) {
                const date = new Date(item.publishedAt);
                searchDate = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            }
            
            // ê¸°ê´€ë³„ ê²€ìƒ‰ URL ìƒì„±
            let searchUrl;
            const encodedKeyword = encodeURIComponent(mainKeyword);
            const encodedAgency = encodeURIComponent(item.agency);
            const encodedDate = encodeURIComponent(searchDate);
            
            switch (item.agencyCode) {
                case 'fsc':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fsc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                case 'fss':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fss.or.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                case 'ftc':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:ftc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                default:
                    searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}&sort=1`;
            }
            
            return searchUrl;
        }

        // URL ìƒì„± í…ŒìŠ¤íŠ¸
        function testUrlGeneration() {
            const resultDiv = document.getElementById('url-test-result');
            
            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            const testItems = [
                {
                    id: 1,
                    title: 'ë””ì§€í„¸ ê¸ˆìœµ í˜ì‹  ë°©ì•ˆ ë°œí‘œ - 10ì›” 17ì¼',
                    agency: 'ê¸ˆìœµìœ„ì›íšŒ',
                    agencyCode: 'fsc',
                    publishedAt: '2024-10-17T09:00:00Z',
                    url: 'https://www.fsc.go.kr/no010101'
                },
                {
                    id: 2,
                    title: 'ì€í–‰ ê±´ì „ì„± ê°ë… ê°•í™” ì¡°ì¹˜ - 10ì›” 17ì¼',
                    agency: 'ê¸ˆìœµê°ë…ì›',
                    agencyCode: 'fss',
                    publishedAt: '2024-10-17T14:30:00Z',
                    url: 'https://www.fss.or.kr/fss/bbs/B0000188/list.do?menuNo=200218'
                },
                {
                    id: 3,
                    title: 'ì˜¨ë¼ì¸ í”Œë«í¼ ë…ì í–‰ìœ„ ì¡°ì‚¬ ì°©ìˆ˜ - 10ì›” 17ì¼',
                    agency: 'ê³µì •ê±°ë˜ìœ„ì›íšŒ',
                    agencyCode: 'ftc',
                    publishedAt: '2024-10-17T11:15:00Z',
                    url: 'https://www.ftc.go.kr/www/selectReportList.do?key=10'
                }
            ];

            let html = '<h4>URL ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h4>';
            
            testItems.forEach(item => {
                const oldUrl = item.url;
                const newUrl = generateArticleUrl(item);
                
                html += `
                    <div style="margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                        <h5>${item.title}</h5>
                        <div class="url-comparison">
                            <div class="old-url">
                                <strong>ê¸°ì¡´ URL:</strong><br>
                                ${oldUrl}
                                <br><small>â†’ ê²Œì‹œíŒ ë©”ì¸ í˜ì´ì§€</small>
                            </div>
                            <div class="new-url">
                                <strong>ê°œì„ ëœ URL:</strong><br>
                                ${newUrl}
                                <br><small>â†’ ê´€ë ¨ ê¸°ì‚¬ ì§ì ‘ ê²€ìƒ‰</small>
                            </div>
                        </div>
                        <button onclick="window.open('${newUrl}', '_blank')" style="margin-top: 10px;">
                            ğŸ” ê°œì„ ëœ ë§í¬ í…ŒìŠ¤íŠ¸
                        </button>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
        }

        // ì‹¤ì œ API ë°ì´í„° í…ŒìŠ¤íŠ¸
        async function loadRealDataTest() {
            const resultDiv = document.getElementById('real-data-test');
            resultDiv.innerHTML = 'ğŸ”„ ì‹¤ì œ ë°ì´í„° ë¡œë”© ì¤‘...';

            try {
                const response = await fetch('/api/news?limit=5');
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    let html = '<h4>ì‹¤ì œ ë³´ë„ìë£Œ ë°ì´í„° í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h4>';
                    
                    result.data.forEach(item => {
                        const oldUrl = item.url;
                        const newUrl = generateArticleUrl(item);
                        
                        html += `
                            <div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                                <h5>${item.title}</h5>
                                <p><strong>ê¸°ê´€:</strong> ${item.agency} | <strong>ë‚ ì§œ:</strong> ${item.date}</p>
                                
                                <div class="url-comparison">
                                    <div class="old-url">
                                        <strong>ê¸°ì¡´:</strong> ${oldUrl.substring(0, 60)}...
                                    </div>
                                    <div class="new-url">
                                        <strong>ê°œì„ :</strong> ${newUrl.substring(0, 60)}...
                                    </div>
                                </div>
                                
                                <div style="margin-top: 10px;">
                                    <button onclick="window.open('${oldUrl}', '_blank')">ê¸°ì¡´ ë§í¬</button>
                                    <button onclick="window.open('${newUrl}', '_blank')" style="background: #28a745;">ê°œì„ ëœ ë§í¬</button>
                                </div>
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = 'âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                }
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        // ë°ëª¨ ì¹´ë“œ ìƒì„±
        function createDemoCards() {
            const demoData = [
                {
                    title: 'ESG ê¸ˆìœµ í™œì„±í™”ë¥¼ ìœ„í•œ ì œë„ ê°œì„  - 10ì›” 17ì¼',
                    agency: 'ê¸ˆìœµìœ„ì›íšŒ',
                    agencyCode: 'fsc',
                    publishedAt: '2024-10-17T10:00:00Z',
                    summary: 'ESG ê¸ˆìœµ í™œì„±í™”ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ì œë„ ê°œì„  ë°©ì•ˆì´ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤.',
                    url: 'https://www.fsc.go.kr/no010101'
                },
                {
                    title: 'ì¹´ë“œì—…ê³„ ìˆ˜ìˆ˜ë£Œ íˆ¬ëª…ì„± ì œê³  - 10ì›” 17ì¼',
                    agency: 'ê¸ˆìœµê°ë…ì›',
                    agencyCode: 'fss',
                    publishedAt: '2024-10-17T15:00:00Z',
                    summary: 'ì¹´ë“œì—…ê³„ì˜ ìˆ˜ìˆ˜ë£Œ íˆ¬ëª…ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ì¡°ì¹˜ê°€ ì‹œí–‰ë©ë‹ˆë‹¤.',
                    url: 'https://www.fss.or.kr/fss/bbs/B0000188/list.do?menuNo=200218'
                }
            ];

            const container = document.getElementById('demo-cards');
            
            demoData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'demo-card';
                
                const improvedUrl = generateArticleUrl(item);
                
                card.innerHTML = `
                    <h5>${item.title}</h5>
                    <p><strong>${item.agency}</strong> | ${new Date(item.publishedAt).toLocaleDateString('ko-KR')}</p>
                    <p>${item.summary}</p>
                    <p><small>ğŸ’¡ í´ë¦­í•˜ë©´ ê´€ë ¨ ê¸°ì‚¬ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì´ë™í•©ë‹ˆë‹¤</small></p>
                `;
                
                card.addEventListener('click', () => {
                    window.open(improvedUrl, '_blank');
                });
                
                container.appendChild(card);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ëª¨ ì¹´ë“œ ìƒì„±
        window.addEventListener('load', () => {
            createDemoCards();
            console.log('ğŸ”— ë³´ë„ìë£Œ ë§í¬ ê°œì„  í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        });
    </script>
</body>
</html>