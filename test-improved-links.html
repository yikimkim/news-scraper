<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔗 보도자료 링크 개선 테스트</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .url-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .url-box {
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            word-break: break-all;
        }
        .old-url {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .new-url {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .test-result {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
        }
        button:hover {
            background: #0056b3;
        }
        .demo-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .demo-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔗 보도자료 링크 개선 기능 테스트</h1>
        <p>기존 게시판 링크 vs 개선된 직접 검색 링크 비교 테스트</p>
    </div>

    <div class="test-section">
        <h3>🎯 개선사항 요약</h3>
        <ul>
            <li><strong>기존 문제</strong>: 원문 보기 클릭 → 게시판 메인 페이지 → 수동으로 해당 보도자료 찾기</li>
            <li><strong>개선 방안</strong>: 원문 보기 클릭 → 바로 관련 기사 검색 결과로 이동</li>
            <li><strong>기술적 구현</strong>: 제목 키워드 + 날짜 + 기관명으로 정확한 검색 쿼리 생성</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>🔄 실시간 URL 생성 테스트</h3>
        <button onclick="testUrlGeneration()">URL 생성 테스트 실행</button>
        <div id="url-test-result"></div>
    </div>

    <div class="test-section">
        <h3>📊 실제 데이터 기반 테스트</h3>
        <button onclick="loadRealDataTest()">실제 보도자료 데이터 테스트</button>
        <div id="real-data-test"></div>
    </div>

    <div class="test-section">
        <h3>🖱️ 클릭 시뮬레이션 테스트</h3>
        <p>아래 카드들을 클릭해보세요. 새 탭에서 관련 기사 검색 결과가 열릴 것입니다:</p>
        <div id="demo-cards"></div>
    </div>

    <script>
        // 개선된 URL 생성 함수 (메인 앱과 동일)
        function generateArticleUrl(item) {
            // 기존 URL이 개별 보도자료를 지시하는 경우
            if (item.url && (item.url.includes('view.do') || item.url.includes('Detail.do') || item.url.includes('/view/') || item.url.includes('/detail/'))) {
                return item.url;
            }
            
            // 제목에서 핵심 키워드 추출
            const titleKeywords = item.title.replace(/- \d+월 \d+일$/, '').trim().split(' ');
            const mainKeyword = titleKeywords[0] || '보도자료';
            
            // 날짜 정보 추출
            let searchDate = '';
            if (item.publishedAt) {
                const date = new Date(item.publishedAt);
                searchDate = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            }
            
            // 기관별 검색 URL 생성
            let searchUrl;
            const encodedKeyword = encodeURIComponent(mainKeyword);
            const encodedAgency = encodeURIComponent(item.agency);
            const encodedDate = encodeURIComponent(searchDate);
            
            switch (item.agencyCode) {
                case 'fsc':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fsc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+보도자료&sort=1`;
                    }
                    break;
                case 'fss':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fss.or.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+보도자료&sort=1`;
                    }
                    break;
                case 'ftc':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:ftc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+보도자료&sort=1`;
                    }
                    break;
                default:
                    searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}&sort=1`;
            }
            
            return searchUrl;
        }

        // URL 생성 테스트
        function testUrlGeneration() {
            const resultDiv = document.getElementById('url-test-result');
            
            // 테스트 데이터 생성
            const testItems = [
                {
                    id: 1,
                    title: '디지털 금융 혁신 방안 발표 - 10월 17일',
                    agency: '금융위원회',
                    agencyCode: 'fsc',
                    publishedAt: '2024-10-17T09:00:00Z',
                    url: 'https://www.fsc.go.kr/no010101'
                },
                {
                    id: 2,
                    title: '은행 건전성 감독 강화 조치 - 10월 17일',
                    agency: '금융감독원',
                    agencyCode: 'fss',
                    publishedAt: '2024-10-17T14:30:00Z',
                    url: 'https://www.fss.or.kr/fss/bbs/B0000188/list.do?menuNo=200218'
                },
                {
                    id: 3,
                    title: '온라인 플랫폼 독점행위 조사 착수 - 10월 17일',
                    agency: '공정거래위원회',
                    agencyCode: 'ftc',
                    publishedAt: '2024-10-17T11:15:00Z',
                    url: 'https://www.ftc.go.kr/www/selectReportList.do?key=10'
                }
            ];

            let html = '<h4>URL 생성 테스트 결과:</h4>';
            
            testItems.forEach(item => {
                const oldUrl = item.url;
                const newUrl = generateArticleUrl(item);
                
                html += `
                    <div style="margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                        <h5>${item.title}</h5>
                        <div class="url-comparison">
                            <div class="old-url">
                                <strong>기존 URL:</strong><br>
                                ${oldUrl}
                                <br><small>→ 게시판 메인 페이지</small>
                            </div>
                            <div class="new-url">
                                <strong>개선된 URL:</strong><br>
                                ${newUrl}
                                <br><small>→ 관련 기사 직접 검색</small>
                            </div>
                        </div>
                        <button onclick="window.open('${newUrl}', '_blank')" style="margin-top: 10px;">
                            🔍 개선된 링크 테스트
                        </button>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
        }

        // 실제 API 데이터 테스트
        async function loadRealDataTest() {
            const resultDiv = document.getElementById('real-data-test');
            resultDiv.innerHTML = '🔄 실제 데이터 로딩 중...';

            try {
                const response = await fetch('/api/news?limit=5');
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    let html = '<h4>실제 보도자료 데이터 테스트 결과:</h4>';
                    
                    result.data.forEach(item => {
                        const oldUrl = item.url;
                        const newUrl = generateArticleUrl(item);
                        
                        html += `
                            <div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                                <h5>${item.title}</h5>
                                <p><strong>기관:</strong> ${item.agency} | <strong>날짜:</strong> ${item.date}</p>
                                
                                <div class="url-comparison">
                                    <div class="old-url">
                                        <strong>기존:</strong> ${oldUrl.substring(0, 60)}...
                                    </div>
                                    <div class="new-url">
                                        <strong>개선:</strong> ${newUrl.substring(0, 60)}...
                                    </div>
                                </div>
                                
                                <div style="margin-top: 10px;">
                                    <button onclick="window.open('${oldUrl}', '_blank')">기존 링크</button>
                                    <button onclick="window.open('${newUrl}', '_blank')" style="background: #28a745;">개선된 링크</button>
                                </div>
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '❌ 데이터를 불러올 수 없습니다.';
                }
                
            } catch (error) {
                resultDiv.innerHTML = `❌ 오류: ${error.message}`;
            }
        }

        // 데모 카드 생성
        function createDemoCards() {
            const demoData = [
                {
                    title: 'ESG 금융 활성화를 위한 제도 개선 - 10월 17일',
                    agency: '금융위원회',
                    agencyCode: 'fsc',
                    publishedAt: '2024-10-17T10:00:00Z',
                    summary: 'ESG 금융 활성화를 위한 새로운 제도 개선 방안이 발표되었습니다.',
                    url: 'https://www.fsc.go.kr/no010101'
                },
                {
                    title: '카드업계 수수료 투명성 제고 - 10월 17일',
                    agency: '금융감독원',
                    agencyCode: 'fss',
                    publishedAt: '2024-10-17T15:00:00Z',
                    summary: '카드업계의 수수료 투명성을 높이기 위한 조치가 시행됩니다.',
                    url: 'https://www.fss.or.kr/fss/bbs/B0000188/list.do?menuNo=200218'
                }
            ];

            const container = document.getElementById('demo-cards');
            
            demoData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'demo-card';
                
                const improvedUrl = generateArticleUrl(item);
                
                card.innerHTML = `
                    <h5>${item.title}</h5>
                    <p><strong>${item.agency}</strong> | ${new Date(item.publishedAt).toLocaleDateString('ko-KR')}</p>
                    <p>${item.summary}</p>
                    <p><small>💡 클릭하면 관련 기사 검색 결과로 이동합니다</small></p>
                `;
                
                card.addEventListener('click', () => {
                    window.open(improvedUrl, '_blank');
                });
                
                container.appendChild(card);
            });
        }

        // 페이지 로드 시 데모 카드 생성
        window.addEventListener('load', () => {
            createDemoCards();
            console.log('🔗 보도자료 링크 개선 테스트 페이지 로드 완료');
        });
    </script>
</body>
</html>