<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .test-result { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .log { background: #f8f9fa; font-family: monospace; padding: 10px; white-space: pre-wrap; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ›ï¸ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-result">
        <h3>1. ë©”ì¸ ì•± ë¡œë“œ ë° ì •ë¶€ íƒ­ í´ë¦­ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testGovernmentTab()">ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í…ŒìŠ¤íŠ¸</button>
        <div id="tab-test" class="log"></div>
    </div>

    <div class="test-result">
        <h3>2. API ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testAPI()">API ì§ì ‘ í…ŒìŠ¤íŠ¸</button>
        <div id="api-test" class="log"></div>
    </div>

    <div class="test-result">
        <h3>3. ê¸°ê´€ í•„í„° í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testAgencyFilter()">ê¸°ê´€ í•„í„° í…ŒìŠ¤íŠ¸</button>
        <div id="filter-test" class="log"></div>
    </div>

    <script>
        async function testGovernmentTab() {
            const logDiv = document.getElementById('tab-test');
            logDiv.textContent = 'ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';

            try {
                // ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ iframe ìƒì„±
                const iframe = document.createElement('iframe');
                iframe.src = '/';
                iframe.style.width = '100%';
                iframe.style.height = '600px';
                iframe.style.border = '1px solid #ddd';
                
                // iframe ë¡œë“œ ì™„ë£Œ ëŒ€ê¸°
                iframe.onload = function() {
                    logDiv.textContent += 'iframe ë¡œë“œ ì™„ë£Œ\n';
                    
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        logDiv.textContent += 'ë¬¸ì„œ ì ‘ê·¼ ì„±ê³µ\n';
                        
                        // ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ë²„íŠ¼ ì°¾ê¸°
                        const govButton = iframeDoc.querySelector('[data-tab="government"]');
                        if (govButton) {
                            logDiv.textContent += 'ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ë²„íŠ¼ ë°œê²¬\n';
                            
                            // í´ë¦­ ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                            govButton.click();
                            logDiv.textContent += 'ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í´ë¦­ ì™„ë£Œ\n';
                            
                            // ì ì‹œ ëŒ€ê¸° í›„ ê²°ê³¼ í™•ì¸
                            setTimeout(() => {
                                const govTab = iframeDoc.getElementById('government-tab');
                                if (govTab && govTab.classList.contains('active')) {
                                    logDiv.textContent += 'âœ… ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í™œì„±í™” ì„±ê³µ\n';
                                    
                                    // ë‰´ìŠ¤ ëª©ë¡ í™•ì¸
                                    const newsList = iframeDoc.getElementById('government-news-list');
                                    if (newsList) {
                                        logDiv.textContent += `ë‰´ìŠ¤ ëª©ë¡ ì»¨í…Œì´ë„ˆ: ${newsList.innerHTML.substring(0, 200)}...\n`;
                                    }
                                } else {
                                    logDiv.textContent += 'âŒ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í™œì„±í™” ì‹¤íŒ¨\n';
                                }
                            }, 2000);
                            
                        } else {
                            logDiv.textContent += 'âŒ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ\n';
                        }
                        
                    } catch (error) {
                        logDiv.textContent += `âŒ iframe ë‚´ë¶€ ì ‘ê·¼ ì˜¤ë¥˜: ${error.message}\n`;
                    }
                };
                
                // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì˜ì—­ì— iframe ì¶”ê°€
                const testDiv = document.getElementById('tab-test').parentNode;
                testDiv.appendChild(iframe);
                
            } catch (error) {
                logDiv.textContent += `âŒ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}\n`;
            }
        }

        async function testAPI() {
            const logDiv = document.getElementById('api-test');
            logDiv.textContent = 'API ì§ì ‘ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';

            try {
                // ë‰´ìŠ¤ API í…ŒìŠ¤íŠ¸
                logDiv.textContent += '1. ë‰´ìŠ¤ ëª©ë¡ API í˜¸ì¶œ...\n';
                const newsResponse = await fetch('/api/news?agency=all&page=1&limit=6');
                const newsResult = await newsResponse.json();
                
                logDiv.textContent += `ë‰´ìŠ¤ API ì‘ë‹µ: ${JSON.stringify(newsResult, null, 2)}\n\n`;
                
                // í†µê³„ API í…ŒìŠ¤íŠ¸  
                logDiv.textContent += '2. í†µê³„ API í˜¸ì¶œ...\n';
                const statsResponse = await fetch('/api/news/stats');
                const statsResult = await statsResponse.json();
                
                logDiv.textContent += `í†µê³„ API ì‘ë‹µ: ${JSON.stringify(statsResult, null, 2)}\n\n`;
                
                if (newsResult.success && statsResult.success) {
                    logDiv.textContent += 'âœ… ëª¨ë“  API ì •ìƒ ì‘ë™\n';
                } else {
                    logDiv.textContent += 'âŒ ì¼ë¶€ API ì˜¤ë¥˜ ë°œìƒ\n';
                }
                
            } catch (error) {
                logDiv.textContent += `âŒ API í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}\n`;
            }
        }

        async function testAgencyFilter() {
            const logDiv = document.getElementById('filter-test');
            logDiv.textContent = 'ê¸°ê´€ í•„í„° í…ŒìŠ¤íŠ¸ ì‹œì‘...\n';

            try {
                const agencies = [
                    { code: 'all', name: 'ì „ì²´' },
                    { code: 'fsc', name: 'ê¸ˆìœµìœ„ì›íšŒ' },
                    { code: 'fss', name: 'ê¸ˆìœµê°ë…ì›' },
                    { code: 'ftc', name: 'ê³µì •ê±°ë˜ìœ„ì›íšŒ' }
                ];
                
                for (const agency of agencies) {
                    logDiv.textContent += `${agency.name} (${agency.code}) í…ŒìŠ¤íŠ¸...\n`;
                    
                    const response = await fetch(`/api/news?agency=${agency.code}&page=1&limit=3`);
                    const result = await response.json();
                    
                    if (result.success) {
                        const count = result.data?.length || 0;
                        logDiv.textContent += `  âœ… ${count}ê°œ ë°ì´í„° í™•ì¸\n`;
                        
                        if (count > 0 && result.data[0].title) {
                            logDiv.textContent += `  ğŸ“„ ìƒ˜í”Œ: ${result.data[0].title.substring(0, 50)}...\n`;
                        }
                    } else {
                        logDiv.textContent += `  âŒ API ì˜¤ë¥˜: ${result.error}\n`;
                    }
                }
                
                logDiv.textContent += '\nâœ… ê¸°ê´€ í•„í„° í…ŒìŠ¤íŠ¸ ì™„ë£Œ\n';
                
            } catch (error) {
                logDiv.textContent += `âŒ ê¸°ê´€ í•„í„° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}\n`;
            }
        }
    </script>
</body>
</html>