<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ë§í¬ ë¬¸ì œ ì§„ë‹¨ ë„êµ¬</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .good { background-color: #d4edda; border-color: #c3e6cb; }
        .bad { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .url-test { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-result { margin-top: 20px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ë§í¬ ë¬¸ì œ ì§„ë‹¨ ë„êµ¬</h1>
    <p><strong>ëª©ì :</strong> ì‚¬ìš©ìê°€ ë³´ê³ í•œ ë§í¬ ë¬¸ì œì˜ ì •í™•í•œ ì›ì¸ ì°¾ê¸°</p>

    <div class="section">
        <h2>ğŸ“Š ë°±ì—”ë“œ ë°ì´í„° ì‹¤ì‹œê°„ ì¡°íšŒ</h2>
        <button class="button" onclick="fetchBackendData()">ë°±ì—”ë“œì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
        <div id="backend-data-result"></div>
    </div>

    <div class="section">
        <h2>ğŸ”— URL ìƒì„± í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
        <button class="button" onclick="testUrlGeneration()">ì‹¤ì œ ë°±ì—”ë“œ ë°ì´í„°ë¡œ URL ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <div id="url-generation-result"></div>
    </div>

    <div class="section">
        <h2>ğŸ¯ ì •í™•í•œ ë¬¸ì œì  íŒŒì•…</h2>
        <div id="problem-analysis"></div>
    </div>

    <div class="section">
        <h2>âœ… ê¶Œì¥ í•´ê²° ë°©ì•ˆ</h2>
        <div id="solution-recommendation"></div>
    </div>

    <script>
        const API_BASE_URL = 'https://3001-imyjsakhqpzwgwbkwlqpw-5c13a017.sandbox.novita.ai';

        // ì •ë¶€ ë³´ë„ìë£Œ URL ìƒì„± í•¨ìˆ˜ (index.htmlê³¼ ë™ì¼)
        function generateArticleUrl(item) {
            // ê¸°ì¡´ URLì´ ê°œë³„ ë³´ë„ìë£Œë¥¼ ì§€ì‹œí•˜ëŠ” ê²½ìš° (ì˜ˆ: view.do, Detail.do í¬í•¨)
            if (item.url && (item.url.includes('view.do') || item.url.includes('Detail.do') || item.url.includes('/view/') || item.url.includes('/detail/'))) {
                return item.url;
            }
            
            // ì œëª©ì—ì„œ í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ
            const titleKeywords = item.title.replace(/- \d+ì›” \d+ì¼$/, '').trim().split(' ');
            const mainKeyword = titleKeywords[0] || 'ë³´ë„ìë£Œ';
            
            // ë‚ ì§œ ì •ë³´ ì¶”ì¶œ (publishedAt ë˜ëŠ” ì œëª©ì—ì„œ)
            let searchDate = '';
            if (item.publishedAt) {
                const date = new Date(item.publishedAt);
                searchDate = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            }
            
            // ê¸°ê´€ë³„ ê²€ìƒ‰ URL ìƒì„± (ë” ì •í™•í•œ ê²€ìƒ‰ì„ ìœ„í•´)
            let searchUrl;
            const encodedKeyword = encodeURIComponent(mainKeyword);
            const encodedAgency = encodeURIComponent(item.agency);
            const encodedDate = encodeURIComponent(searchDate);
            
            switch (item.agencyCode) {
                case 'fsc':
                    // ê¸ˆìœµìœ„ì›íšŒ ì‚¬ì´íŠ¸ ë‚´ ê²€ìƒ‰ + ë„¤ì´ë²„ ê²€ìƒ‰ ì¡°í•©
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fsc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                    
                case 'fss':
                    // ê¸ˆìœµê°ë…ì› ì‚¬ì´íŠ¸ ë‚´ ê²€ìƒ‰ + ë„¤ì´ë²„ ê²€ìƒ‰ ì¡°í•©
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fss.or.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                    
                case 'ftc':
                    // ê³µì •ê±°ë˜ìœ„ì›íšŒ ì‚¬ì´íŠ¸ ë‚´ ê²€ìƒ‰ + ë„¤ì´ë²„ ê²€ìƒ‰ ì¡°í•©
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:ftc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                    
                default:
                    // ê¸°ë³¸ ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰
                    searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}&sort=1`;
            }
            
            return searchUrl;
        }

        async function fetchBackendData() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/news?agency=all&page=1&limit=10`);
                const result = await response.json();
                
                if (result.success) {
                    let html = `
                        <div class="section good">
                            <h3>âœ… ë°±ì—”ë“œ ì—°ê²° ì„±ê³µ</h3>
                            <p>ì´ ${result.pagination.totalCount}ê°œì˜ ë³´ë„ìë£Œë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p>
                            <p>í˜„ì¬ í˜ì´ì§€: ${result.pagination.page}/${result.pagination.totalPages}</p>
                        </div>
                        <h3>ğŸ“‹ ì‹¤ì œ ë³´ë„ìë£Œ ë°ì´í„°:</h3>
                    `;
                    
                    result.data.forEach((item, index) => {
                        const isDirectUrl = item.url && (
                            item.url.includes('view.do') || 
                            item.url.includes('Detail.do') || 
                            item.url.includes('/view/') || 
                            item.url.includes('/detail/')
                        );
                        
                        html += `
                            <div class="url-test ${isDirectUrl ? 'good' : 'bad'}">
                                <strong>${index + 1}. ${item.title}</strong><br>
                                <strong>ê¸°ê´€:</strong> ${item.agency}<br>
                                <strong>ì›ë³¸ URL:</strong> <a href="${item.url}" target="_blank">${item.url}</a><br>
                                <strong>URL ìƒíƒœ:</strong> ${isDirectUrl ? 'âœ… ì§ì ‘ ë§í¬ (ì¢‹ìŒ)' : 'âŒ ê²Œì‹œíŒ ë§í¬ (ìˆ˜ì • í•„ìš”)'}
                            </div>
                        `;
                    });
                    
                    document.getElementById('backend-data-result').innerHTML = html;
                    
                    // ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„° ì €ì¥
                    window.backendData = result.data;
                } else {
                    throw new Error(result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
            } catch (error) {
                document.getElementById('backend-data-result').innerHTML = `
                    <div class="section bad">
                        <h3>âŒ ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨</h3>
                        <p>ì˜¤ë¥˜: ${error.message}</p>
                        <p>API URL: ${API_BASE_URL}/api/news</p>
                    </div>
                `;
            }
        }

        function testUrlGeneration() {
            if (!window.backendData) {
                document.getElementById('url-generation-result').innerHTML = `
                    <div class="section warning">
                        <h3>âš ï¸ ë¨¼ì € ë°±ì—”ë“œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì£¼ì„¸ìš”</h3>
                    </div>
                `;
                return;
            }

            let html = '<h3>ğŸ”— URL ìƒì„± í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h3>';
            
            window.backendData.forEach((item, index) => {
                const originalUrl = item.url;
                const generatedUrl = generateArticleUrl(item);
                const isChanged = originalUrl !== generatedUrl;
                
                html += `
                    <div class="url-test ${isChanged ? 'warning' : 'good'}">
                        <strong>${index + 1}. ${item.title}</strong><br>
                        <strong>ì›ë³¸ URL:</strong> <a href="${originalUrl}" target="_blank">${originalUrl}</a><br>
                        <strong>ìƒì„±ëœ URL:</strong> <a href="${generatedUrl}" target="_blank">${generatedUrl}</a><br>
                        <strong>ê²°ê³¼:</strong> ${isChanged ? 'ğŸ”„ URLì´ ë³€ê²½ë¨ (ë„¤ì´ë²„ ê²€ìƒ‰ìœ¼ë¡œ ë³€í™˜)' : 'âœ… ì›ë³¸ URL ìœ ì§€ (ì§ì ‘ ë§í¬)'}
                    </div>
                `;
            });
            
            document.getElementById('url-generation-result').innerHTML = html;
            
            // ë¬¸ì œ ë¶„ì„ ìˆ˜í–‰
            analyzeProblem();
        }

        function analyzeProblem() {
            if (!window.backendData) return;
            
            let directUrls = 0;
            let boardUrls = 0;
            let problemUrls = [];
            
            window.backendData.forEach((item, index) => {
                const isDirectUrl = item.url && (
                    item.url.includes('view.do') || 
                    item.url.includes('Detail.do') || 
                    item.url.includes('/view/') || 
                    item.url.includes('/detail/')
                );
                
                if (isDirectUrl) {
                    directUrls++;
                } else {
                    boardUrls++;
                    problemUrls.push({
                        index: index + 1,
                        title: item.title,
                        url: item.url,
                        agency: item.agency
                    });
                }
            });
            
            let analysisHtml = `
                <div class="section ${boardUrls === 0 ? 'good' : 'warning'}">
                    <h3>ğŸ“Š URL ë¶„ì„ ê²°ê³¼</h3>
                    <p><strong>ì§ì ‘ ë§í¬:</strong> ${directUrls}ê°œ (${((directUrls / window.backendData.length) * 100).toFixed(1)}%)</p>
                    <p><strong>ê²Œì‹œíŒ ë§í¬:</strong> ${boardUrls}ê°œ (${((boardUrls / window.backendData.length) * 100).toFixed(1)}%)</p>
                </div>
            `;
            
            if (problemUrls.length > 0) {
                analysisHtml += `
                    <div class="section bad">
                        <h3>âŒ ë¬¸ì œê°€ ìˆëŠ” URLë“¤</h3>
                        <p>ë‹¤ìŒ ë³´ë„ìë£Œë“¤ì€ ê²Œì‹œíŒ ë§í¬ë¡œ, ì§ì ‘ ê¸°ì‚¬ë¡œ ì—°ê²°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤:</p>
                `;
                
                problemUrls.forEach(item => {
                    analysisHtml += `
                        <div class="url-test">
                            <strong>${item.index}. ${item.title}</strong><br>
                            <strong>ê¸°ê´€:</strong> ${item.agency}<br>
                            <strong>ë¬¸ì œ URL:</strong> <a href="${item.url}" target="_blank">${item.url}</a>
                        </div>
                    `;
                });
                
                analysisHtml += '</div>';
            }
            
            document.getElementById('problem-analysis').innerHTML = analysisHtml;
            
            // í•´ê²° ë°©ì•ˆ ì œì‹œ
            provideSolution(boardUrls, problemUrls);
        }

        function provideSolution(boardUrls, problemUrls) {
            let solutionHtml = '';
            
            if (boardUrls === 0) {
                solutionHtml = `
                    <div class="section good">
                        <h3>âœ… í˜„ì¬ ìƒíƒœ: ë¬¸ì œ ì—†ìŒ</h3>
                        <p>ëª¨ë“  ë³´ë„ìë£Œê°€ ì´ë¯¸ ì§ì ‘ ë§í¬ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                        <p><strong>ì‚¬ìš©ì ë³´ê³  ì‚¬í•­ ë¶„ì„:</strong></p>
                        <ul>
                            <li>ì‚¬ìš©ìê°€ ì–¸ê¸‰í•œ "ì›ë¬¸ ë³´ê¸°", "ìì„¸íˆ ì½ê¸°" ë²„íŠ¼ì´ í˜„ì¬ ì½”ë“œì—ì„œ ë°œê²¬ë˜ì§€ ì•ŠìŒ</li>
                            <li>í˜„ì¬ ì½”ë“œì˜ ì‹¤ì œ ë²„íŠ¼: "ğŸ“– ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸°", "ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸° â†’"</li>
                            <li>URL ìƒì„± í•¨ìˆ˜ë“¤ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŒ</li>
                        </ul>
                        <p><strong>ì¶”ì²œ ì¡°ì¹˜:</strong></p>
                        <ul>
                            <li>ì‚¬ìš©ìì—ê²Œ ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ ìš”ì²­</li>
                            <li>ì‹¤ì œ ì‚¬ìš© ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ í™•ì¸</li>
                            <li>ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í™•ì¸</li>
                        </ul>
                    </div>
                `;
            } else {
                solutionHtml = `
                    <div class="section warning">
                        <h3>âš ï¸ ë¬¸ì œ ë°œê²¬: ${boardUrls}ê°œì˜ ê²Œì‹œíŒ ë§í¬</h3>
                        <p>ì¼ë¶€ ë³´ë„ìë£Œê°€ ì§ì ‘ ë§í¬ê°€ ì•„ë‹Œ ê²Œì‹œíŒ ë§í¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                        <p><strong>í•´ê²° ë°©ì•ˆ:</strong></p>
                        <ol>
                            <li><strong>ìŠ¤í¬ë˜í¼ ê°œì„ :</strong> ê° ê¸°ê´€ì˜ ê°œë³„ ë³´ë„ìë£Œ URL ìˆ˜ì§‘ ë¡œì§ ê°•í™”</li>
                            <li><strong>URL ê²€ì¦ ë¡œì§ ì¶”ê°€:</strong> ê²Œì‹œíŒ ë§í¬ ê°ì§€ ë° ìë™ ë³€í™˜</li>
                            <li><strong>ë°±ì—… ê²€ìƒ‰ ì‹œìŠ¤í…œ:</strong> ì§ì ‘ ë§í¬ê°€ ì—†ëŠ” ê²½ìš° ë„¤ì´ë²„ ê²€ìƒ‰ í™œìš©</li>
                        </ol>
                    </div>
                    
                    <div class="section">
                        <h3>ğŸ”§ êµ¬ì²´ì  ìˆ˜ì • ì‚¬í•­</h3>
                        <pre>
// ë°±ì—”ë“œ ìŠ¤í¬ë˜í¼ ê°œì„  í•„ìš”
// ê° ê¸°ê´€ë³„ ê°œë³„ ë³´ë„ìë£Œ URL íŒ¨í„´ ë¶„ì„:
// - ê¸ˆìœµìœ„ì›íšŒ: view.do?contentNo=xxx í˜•íƒœë¡œ ìˆ˜ì§‘
// - ê¸ˆìœµê°ë…ì›: /view/ ê²½ë¡œ í¬í•¨í•˜ì—¬ ìˆ˜ì§‘  
// - ê³µì •ê±°ë˜ìœ„ì›íšŒ: selectReportDetail.do?rptNo=xxx í˜•íƒœë¡œ ìˆ˜ì§‘

// í”„ë¡ íŠ¸ì—”ë“œ ê²€ì¦ ë¡œì§ ì¶”ê°€
function isDirectUrl(url) {
    return url && (
        url.includes('view.do') ||
        url.includes('Detail.do') ||  
        url.includes('/view/') ||
        url.includes('/detail/') ||
        url.includes('selectReportDetail.do')
    );
}
                        </pre>
                    </div>
                `;
            }
            
            document.getElementById('solution-recommendation').innerHTML = solutionHtml;
        }
    </script>
</body>
</html>