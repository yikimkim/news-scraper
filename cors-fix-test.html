<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background-color: #f8d7da; }
        .success { border-left-color: #28a745; background-color: #d4edda; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .news-card { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .government-card { border-left: 4px solid #28a745; }
        .search-card { border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <h1>âœ… CORS ìˆ˜ì • í›„ ì •ë¶€ ë³´ë„ìë£Œ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-result">
        <h3>ğŸ”§ ìˆ˜ì •ëœ ì‚¬í•­</h3>
        <ul>
            <li><strong>ë°±ì—”ë“œ CORS ì„¤ì • ì¶”ê°€:</strong> í¬íŠ¸ 8080 í—ˆìš©</li>
            <li><strong>ìƒˆ ë°±ì—”ë“œ URL:</strong> https://3002-imyjsakhqpzwgwbkwlqpw-5c13a017.sandbox.novita.ai</li>
            <li><strong>í”„ë¡ íŠ¸ì—”ë“œ API URL ì—…ë°ì´íŠ¸:</strong> í¬íŠ¸ 3002ë¡œ ë³€ê²½</li>
        </ul>
    </div>

    <button class="button" onclick="testCORSFixed()">CORS ìˆ˜ì • í™•ì¸</button>
    <div id="cors-test"></div>

    <button class="button" onclick="testGovernmentNews()">ì •ë¶€ ë³´ë„ìë£Œ API í…ŒìŠ¤íŠ¸</button>
    <div id="government-news-test"></div>

    <button class="button" onclick="simulateGovernmentTab()">ì •ë¶€ íƒ­ ì‹œë®¬ë ˆì´ì…˜</button>
    <div id="government-simulation"></div>

    <script>
        const API_BASE_URL = 'https://3002-imyjsakhqpzwgwbkwlqpw-5c13a017.sandbox.novita.ai';

        async function testCORSFixed() {
            const resultDiv = document.getElementById('cors-test');
            resultDiv.innerHTML = '<p>CORS í…ŒìŠ¤íŠ¸ ì¤‘...</p>';

            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const result = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <h4>âœ… CORS ë¬¸ì œ í•´ê²° ì™„ë£Œ!</h4>
                            <p><strong>ì„œë²„ ìƒíƒœ:</strong> ${result.status}</p>
                            <p><strong>ì‘ë‹µ ì‹œê°„:</strong> ì •ìƒ</p>
                            <p><strong>CORS í—¤ë”:</strong> ì •ìƒ ì„¤ì •ë¨</p>
                        </div>
                    `;
                } else {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ CORS ë¬¸ì œ ì§€ì†</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testGovernmentNews() {
            const resultDiv = document.getElementById('government-news-test');
            resultDiv.innerHTML = '<p>ì •ë¶€ ë‰´ìŠ¤ API í…ŒìŠ¤íŠ¸ ì¤‘...</p>';

            try {
                const response = await fetch(`${API_BASE_URL}/api/news?agency=all&page=1&limit=5`);
                const result = await response.json();

                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <h4>âœ… ì •ë¶€ ë³´ë„ìë£Œ API ì„±ê³µ!</h4>
                            <p><strong>ì´ ë³´ë„ìë£Œ:</strong> ${result.pagination.totalCount}ê°œ</p>
                            <p><strong>ê°€ì ¸ì˜¨ ë°ì´í„°:</strong> ${result.data.length}ê°œ</p>
                            <p><strong>ì²« ë²ˆì§¸ ê¸°ì‚¬:</strong> ${result.data[0].title}</p>
                            <p><strong>ê¸°ê´€:</strong> ${result.data[0].agency}</p>
                        </div>
                    `;
                } else {
                    throw new Error(result.message || 'API ì‘ë‹µ ì˜¤ë¥˜');
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ API í˜¸ì¶œ ì‹¤íŒ¨</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function simulateGovernmentTab() {
            const resultDiv = document.getElementById('government-simulation');
            resultDiv.innerHTML = '<p>ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...</p>';

            try {
                const response = await fetch(`${API_BASE_URL}/api/news?agency=all&page=1&limit=8`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'API ì˜¤ë¥˜');
                }

                // HTML ìƒì„± (ë©”ì¸ ì•±ê³¼ ë™ì¼í•œ ë¡œì§)
                let cardsHTML = '';
                result.data.forEach((item) => {
                    const isDirectUrl = item.url && (
                        item.url.includes('view.do') || 
                        item.url.includes('Detail.do') || 
                        item.url.includes('/view/') || 
                        item.url.includes('/detail/') ||
                        item.url.includes('selectReportDetail.do') ||
                        item.url.includes('?contentNo=') ||
                        item.url.includes('?rptNo=')
                    );

                    cardsHTML += `
                        <div class="news-card ${isDirectUrl ? 'government-card' : 'search-card'}">
                            <h4>${item.title}</h4>
                            <p><strong>ê¸°ê´€:</strong> ${item.agency} | <strong>ë‚ ì§œ:</strong> ${item.date}</p>
                            <p>${item.summary}</p>
                            <div>
                                <a href="${item.url}" target="_blank" style="color: #007bff; text-decoration: none;">
                                    ğŸ“– ì›ë¬¸ ë³´ê¸°
                                </a>
                                <span style="margin-left: 20px; color: ${isDirectUrl ? '#28a745' : '#ffc107'};">
                                    ${isDirectUrl ? 'âœ… ì§ì ‘ ë§í¬' : 'ğŸ” ê²€ìƒ‰ ë§í¬'}
                                </span>
                            </div>
                        </div>
                    `;
                });

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        <h4>ğŸ‰ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ì •ìƒ ì‘ë™!</h4>
                        <p><strong>ë³´ë„ìë£Œ ${result.data.length}ê°œ ë¡œë“œ ì„±ê³µ</strong></p>
                        <p><strong>ì´ì œ ë©”ì¸ ì•±ì—ì„œ "ğŸ›ï¸ ì •ë¶€ ë³´ë„ìë£Œ" íƒ­ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•  ê²ƒì…ë‹ˆë‹¤!</strong></p>
                        
                        <h5>ğŸ“‹ ë³´ë„ìë£Œ ë¯¸ë¦¬ë³´ê¸°:</h5>
                        <div style="max-height: 600px; overflow-y: auto;">
                            ${cardsHTML}
                        </div>
                    </div>
                `;

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', async () => {
            console.log('CORS ìˆ˜ì • í…ŒìŠ¤íŠ¸ ì‹œì‘');
            await testCORSFixed();
            setTimeout(() => testGovernmentNews(), 1000);
            setTimeout(() => simulateGovernmentTab(), 2000);
        });
    </script>
</body>
</html>