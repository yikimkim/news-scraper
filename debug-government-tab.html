<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ë””ë²„ê¹…</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background-color: #f8d7da; }
        .success { border-left-color: #28a745; background-color: #d4edda; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ğŸ” ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ì˜¤ë¥˜ ë””ë²„ê¹…</h1>
    
    <div class="test-result">
        <h3>í˜„ì¬ ìƒí™©</h3>
        <p>ì‚¬ìš©ì ë³´ê³ : ì •ë¶€ ë³´ë„ìë£Œ íƒ­ì—ì„œ "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ</p>
    </div>

    <button class="button" onclick="testDirectAPI()">1. ë°±ì—”ë“œ API ì§ì ‘ í…ŒìŠ¤íŠ¸</button>
    <div id="api-test-result"></div>

    <button class="button" onclick="testCORS()">2. CORS ë¬¸ì œ í™•ì¸</button>
    <div id="cors-test-result"></div>

    <button class="button" onclick="testFrontendFunction()">3. í”„ë¡ íŠ¸ì—”ë“œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</button>
    <div id="frontend-test-result"></div>

    <script>
        const API_BASE_URL = 'https://3001-imyjsakhqpzwgwbkwlqpw-5c13a017.sandbox.novita.ai';

        async function testDirectAPI() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.innerHTML = '<p>API í…ŒìŠ¤íŠ¸ ì¤‘...</p>';

            try {
                console.log('API ìš”ì²­ ì‹œì‘:', `${API_BASE_URL}/api/news?agency=all&page=1&limit=5`);
                
                const response = await fetch(`${API_BASE_URL}/api/news?agency=all&page=1&limit=5`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                console.log('ì‘ë‹µ í—¤ë”:', response.headers);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('API ì‘ë‹µ:', result);

                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <h4>âœ… API í˜¸ì¶œ ì„±ê³µ</h4>
                            <p><strong>ì´ ë³´ë„ìë£Œ:</strong> ${result.pagination.totalCount}ê°œ</p>
                            <p><strong>í˜„ì¬ í˜ì´ì§€:</strong> ${result.pagination.page}/${result.pagination.totalPages}</p>
                            <p><strong>ì²« ë²ˆì§¸ ê¸°ì‚¬:</strong> ${result.data[0].title}</p>
                            <pre>${JSON.stringify(result, null, 2).substring(0, 500)}...</pre>
                        </div>
                    `;
                } else {
                    throw new Error(`API ì˜¤ë¥˜: ${result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }

            } catch (error) {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ API í˜¸ì¶œ ì‹¤íŒ¨</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                        <p><strong>API URL:</strong> ${API_BASE_URL}/api/news</p>
                        <p><strong>ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ê°€ëŠ¥ì„±:</strong> CORS, ì„œë²„ ë‹¤ìš´, ì˜ëª»ëœ URL</p>
                    </div>
                `;
            }
        }

        async function testCORS() {
            const resultDiv = document.getElementById('cors-test-result');
            resultDiv.innerHTML = '<p>CORS í…ŒìŠ¤íŠ¸ ì¤‘...</p>';

            try {
                // OPTIONS ìš”ì²­ìœ¼ë¡œ CORS preflight í™•ì¸
                const optionsResponse = await fetch(`${API_BASE_URL}/api/news`, {
                    method: 'OPTIONS'
                });

                console.log('OPTIONS ì‘ë‹µ:', optionsResponse.status);

                // ì‹¤ì œ GET ìš”ì²­
                const getResponse = await fetch(`${API_BASE_URL}/api/news?agency=all&page=1&limit=1`, {
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'omit'
                });

                console.log('GET ì‘ë‹µ:', getResponse.status);

                if (getResponse.ok) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <h4>âœ… CORS ë¬¸ì œ ì—†ìŒ</h4>
                            <p>OPTIONS: ${optionsResponse.status}, GET: ${getResponse.status}</p>
                        </div>
                    `;
                } else {
                    throw new Error(`GET ìš”ì²­ ì‹¤íŒ¨: ${getResponse.status}`);
                }

            } catch (error) {
                console.error('CORS í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ CORS ë¬¸ì œ ë°œê²¬</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                        <p><strong>ê°€ëŠ¥í•œ ì›ì¸:</strong></p>
                        <ul>
                            <li>ë°±ì—”ë“œ ì„œë²„ì˜ CORS ì„¤ì • ë¬¸ì œ</li>
                            <li>ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…</li>
                            <li>ì˜ëª»ëœ API URL</li>
                        </ul>
                    </div>
                `;
            }
        }

        async function testFrontendFunction() {
            const resultDiv = document.getElementById('frontend-test-result');
            resultDiv.innerHTML = '<p>í”„ë¡ íŠ¸ì—”ë“œ í•¨ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...</p>';

            try {
                // ë©”ì¸ ì•±ì˜ displayGovernmentNews í•¨ìˆ˜ì™€ ìœ ì‚¬í•œ ë¡œì§ í…ŒìŠ¤íŠ¸
                console.log('ì •ë¶€ ë‰´ìŠ¤ í‘œì‹œ í•¨ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘');

                const response = await fetch(`${API_BASE_URL}/api/news?agency=all&page=1&limit=10`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'API ì‘ë‹µì—ì„œ successê°€ false');
                }

                // HTML ìƒì„± ì‹œë®¬ë ˆì´ì…˜
                let htmlContent = '';
                result.data.forEach((item, index) => {
                    const isDirectUrl = item.url && (
                        item.url.includes('view.do') || 
                        item.url.includes('Detail.do') || 
                        item.url.includes('/view/') || 
                        item.url.includes('/detail/') ||
                        item.url.includes('selectReportDetail.do') ||
                        item.url.includes('?contentNo=') ||
                        item.url.includes('?rptNo=')
                    );

                    htmlContent += `
                        <div style="border: 1px solid #ddd; margin: 10px; padding: 10px; border-left: 4px solid ${isDirectUrl ? '#28a745' : '#ffc107'};">
                            <h4>${item.title}</h4>
                            <p><strong>ê¸°ê´€:</strong> ${item.agency}</p>
                            <p><strong>URL íƒ€ì…:</strong> ${isDirectUrl ? 'âœ… ì§ì ‘ ë§í¬' : 'ğŸ” ê²€ìƒ‰ ë§í¬'}</p>
                            <a href="${item.url}" target="_blank">ğŸ“– ì›ë¬¸ ë³´ê¸°</a>
                        </div>
                    `;
                });

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        <h4>âœ… í”„ë¡ íŠ¸ì—”ë“œ í•¨ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ ì„±ê³µ</h4>
                        <p><strong>ì²˜ë¦¬ëœ ê¸°ì‚¬ ìˆ˜:</strong> ${result.data.length}ê°œ</p>
                        <p><strong>HTML ìƒì„±:</strong> ì„±ê³µ</p>
                        <div style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                            ${htmlContent}
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('í”„ë¡ íŠ¸ì—”ë“œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ í”„ë¡ íŠ¸ì—”ë“œ í•¨ìˆ˜ ì˜¤ë¥˜</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                        <p><strong>ì˜¤ë¥˜ ìŠ¤íƒ:</strong></p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.addEventListener('load', async () => {
            console.log('ë””ë²„ê¹… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            await testDirectAPI();
            setTimeout(() => testCORS(), 1000);
            setTimeout(() => testFrontendFunction(), 2000);
        });
    </script>
</body>
</html>