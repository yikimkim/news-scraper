<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ… ìµœì¢… ë§í¬ ê¸°ëŠ¥ ê²€ì¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .test-result { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #007bff; }
        .direct-link { border-left-color: #28a745; background-color: #d4edda; }
        .search-link { border-left-color: #ffc107; background-color: #fff3cd; }
    </style>
</head>
<body>
    <h1>âœ… ìµœì¢… ë§í¬ ê¸°ëŠ¥ ê²€ì¦</h1>
    
    <div class="section success">
        <h2>ğŸ”§ ìˆ˜ì •ëœ ì‚¬í•­ ìš”ì•½</h2>
        <ul>
            <li><strong>ë²„íŠ¼ í…ìŠ¤íŠ¸ ìˆ˜ì •:</strong></li>
            <ul>
                <li>ì •ë¶€ ë³´ë„ìë£Œ: "ğŸ“– ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸°" â†’ "ğŸ“– ì›ë¬¸ ë³´ê¸°"</li>
                <li>ë¹ ë¥¸ ê²€ìƒ‰: "ê´€ë ¨ ê¸°ì‚¬ ì°¾ê¸° â†’" â†’ "ìì„¸íˆ ì½ê¸° â†’"</li>
            </ul>
            <li><strong>URL ê²€ì¦ ë¡œì§ ê°•í™”:</strong> ë” ë§ì€ ì§ì ‘ ë§í¬ íŒ¨í„´ ì¸ì‹</li>
            <li><strong>ì‹œê°ì  í”¼ë“œë°± ì¶”ê°€:</strong> ì§ì ‘ ë§í¬ vs ê²€ìƒ‰ ë§í¬ êµ¬ë¶„ í‘œì‹œ</li>
            <li><strong>ë¡œê¹… ê°œì„ :</strong> URL ìƒì„± ê³¼ì • ìƒì„¸ ì¶”ì </li>
            <li><strong>íˆ´íŒ ê°œì„ :</strong> ë§í¬ íƒ€ì…ì— ë”°ë¥¸ ì„¤ëª…</li>
        </ul>
    </div>

    <div class="section info">
        <h2>ğŸ” ë°±ì—”ë“œ ë°ì´í„° í™•ì¸</h2>
        <button class="button" onclick="testBackendConnection()">ë°±ì—”ë“œ ì—°ê²° ë° ë°ì´í„° í™•ì¸</button>
        <div id="backend-test-result"></div>
    </div>

    <div class="section info">
        <h2>ğŸ¯ URL ìƒì„± í…ŒìŠ¤íŠ¸</h2>
        <button class="button" onclick="runUrlTests()">ì‹¤ì œ ë°ì´í„°ë¡œ URL ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <div id="url-test-result"></div>
    </div>

    <div class="section info">
        <h2>ğŸ“± ì‚¬ìš©ì ê²½í—˜ ì‹œë®¬ë ˆì´ì…˜</h2>
        <button class="button" onclick="simulateUserClicks()">ì‚¬ìš©ì í´ë¦­ ì‹œë®¬ë ˆì´ì…˜</button>
        <div id="user-simulation-result"></div>
    </div>

    <div class="section">
        <h2>ğŸ“‹ ì‚¬ìš©ìë¥¼ ìœ„í•œ ìµœì¢… ì•ˆë‚´</h2>
        <div class="test-result success">
            <h3>âœ… í•´ê²°ëœ ë¬¸ì œì ë“¤</h3>
            <p><strong>1. ë²„íŠ¼ í…ìŠ¤íŠ¸ ë§¤ì¹­:</strong> "ì›ë¬¸ ë³´ê¸°"ì™€ "ìì„¸íˆ ì½ê¸°" ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ ì™„ë£Œ</p>
            <p><strong>2. ì§ì ‘ ë§í¬ ìš°ì„  ì‚¬ìš©:</strong> ì´ë¯¸ ì •í™•í•œ URLì´ ìˆëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©</p>
            <p><strong>3. ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰ ëŒ€ì•ˆ:</strong> ì§ì ‘ ë§í¬ê°€ ì—†ëŠ” ê²½ìš° ìµœì í™”ëœ ê²€ìƒ‰ URL ìƒì„±</p>
            <p><strong>4. ì‹œê°ì  êµ¬ë¶„:</strong> ì§ì ‘ ë§í¬(ì´ˆë¡)ì™€ ê²€ìƒ‰ ë§í¬(ë…¸ë‘) ì‹œê°ì  í‘œì‹œ</p>
        </div>

        <div class="test-result info">
            <h3>ğŸš€ ë¸Œë¼ìš°ì € ìºì‹œ ì´ˆê¸°í™” ê¶Œì¥</h3>
            <p>ìˆ˜ì • ì‚¬í•­ì„ í™•ì¸í•˜ë ¤ë©´ <strong>Ctrl+F5</strong> ë˜ëŠ” <strong>Cmd+Shift+R</strong>ë¡œ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.</p>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://3001-imyjsakhqpzwgwbkwlqpw-5c13a017.sandbox.novita.ai';

        // URL ìƒì„± í•¨ìˆ˜ë“¤ (index.htmlê³¼ ë™ì¼)
        function generateArticleUrl(item) {
            if (item.url && (
                item.url.includes('view.do') || 
                item.url.includes('Detail.do') || 
                item.url.includes('/view/') || 
                item.url.includes('/detail/') ||
                item.url.includes('selectReportDetail.do') ||
                item.url.includes('/read.') ||
                item.url.includes('?contentNo=') ||
                item.url.includes('?rptNo=')
            )) {
                console.log(`ì •ë¶€ ë³´ë„ìë£Œ ì§ì ‘ ë§í¬ ì‚¬ìš©: ${item.url}`);
                return item.url;
            }
            
            console.log(`ì •ë¶€ ë³´ë„ìë£Œ ê²€ìƒ‰ ë§í¬ ìƒì„± ì‹œì‘: "${item.title}"`);
            
            const titleKeywords = item.title.replace(/- \d+ì›” \d+ì¼$/, '').trim().split(' ');
            const mainKeyword = titleKeywords[0] || 'ë³´ë„ìë£Œ';
            
            let searchDate = '';
            if (item.publishedAt) {
                const date = new Date(item.publishedAt);
                searchDate = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            }
            
            let searchUrl;
            const encodedKeyword = encodeURIComponent(mainKeyword);
            const encodedAgency = encodeURIComponent(item.agency);
            const encodedDate = encodeURIComponent(searchDate);
            
            switch (item.agencyCode) {
                case 'fsc':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fsc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                case 'fss':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:fss.or.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                case 'ftc':
                    if (searchDate) {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=site:ftc.go.kr+${encodedKeyword}+${encodedDate}&sort=1`;
                    } else {
                        searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}+ë³´ë„ìë£Œ&sort=1`;
                    }
                    break;
                default:
                    searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodedAgency}+${encodedKeyword}&sort=1`;
            }
            
            console.log(`ì •ë¶€ ë³´ë„ìë£Œ ìµœì¢… ê²€ìƒ‰ URL: ${searchUrl}`);
            return searchUrl;
        }

        function generateQuickSearchUrl(article, searchKeyword) {
            if (article.url && (article.url.includes('news.naver.com/main/read') || article.url.includes('/article/') || article.url.includes('/view/'))) {
                return article.url;
            }
            
            let cleanTitle = article.title.replace(/ - .*$/, '').trim();
            cleanTitle = cleanTitle.replace(/\.\.\..*$/, '').trim();
            
            const titleWords = cleanTitle.split(' ').filter(word => word.length > 1);
            const keyTitleWords = titleWords.slice(0, 3).join(' ');
            
            let searchDate = '';
            if (article.publishedAt) {
                try {
                    let dateObj;
                    if (typeof article.publishedAt === 'string') {
                        const dateStr = article.publishedAt.replace(/ì— ëŒ€í•œ .*$/, '').trim();
                        dateObj = new Date(dateStr);
                    } else {
                        dateObj = new Date(article.publishedAt);
                    }
                    
                    if (!isNaN(dateObj.getTime())) {
                        searchDate = `${dateObj.getFullYear()}.${String(dateObj.getMonth() + 1).padStart(2, '0')}.${String(dateObj.getDate()).padStart(2, '0')}`;
                    }
                } catch (error) {
                    console.warn('ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜:', error);
                }
            }
            
            const searchParts = [];
            
            if (searchKeyword && searchKeyword.trim()) {
                searchParts.push(searchKeyword.trim());
            }
            
            if (keyTitleWords && keyTitleWords !== searchKeyword) {
                searchParts.push(keyTitleWords);
            }
            
            if (searchDate) {
                searchParts.push(searchDate);
            }
            
            const finalSearchQuery = searchParts.join(' ').trim();
            const searchUrl = `https://search.naver.com/search.naver?where=news&query=${encodeURIComponent(finalSearchQuery)}&sort=1`;
            
            console.log(`ë¹ ë¥¸ ê²€ìƒ‰ URL ìƒì„±: "${article.title}" -> "${finalSearchQuery}" -> ${searchUrl}`);
            return searchUrl;
        }

        async function testBackendConnection() {
            const resultDiv = document.getElementById('backend-test-result');
            resultDiv.innerHTML = '<p>ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</p>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/news?agency=all&page=1&limit=5`);
                const result = await response.json();
                
                if (result.success) {
                    let html = `
                        <div class="test-result success">
                            <h4>âœ… ë°±ì—”ë“œ ì—°ê²° ì„±ê³µ</h4>
                            <p><strong>ì´ ë³´ë„ìë£Œ:</strong> ${result.pagination.totalCount}ê°œ</p>
                            <p><strong>API ì‘ë‹µ ì‹œê°„:</strong> ì •ìƒ</p>
                            <p><strong>ìµœì‹  ë³´ë„ìë£Œ 5ê°œ:</strong></p>
                            <ul>
                    `;
                    
                    result.data.forEach(item => {
                        const isDirectUrl = item.url && (
                            item.url.includes('view.do') || 
                            item.url.includes('Detail.do') ||
                            item.url.includes('selectReportDetail.do') ||
                            item.url.includes('?contentNo=') ||
                            item.url.includes('?rptNo=')
                        );
                        html += `<li><strong>${item.agency}</strong>: ${item.title} ${isDirectUrl ? 'âœ…' : 'ğŸ”'}</li>`;
                    });
                    
                    html += '</ul></div>';
                    
                    // ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                    window.testData = result.data;
                    
                } else {
                    html = `<div class="test-result" style="border-left-color: #dc3545;">âŒ API ì˜¤ë¥˜: ${result.message}</div>`;
                }
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result" style="border-left-color: #dc3545;">
                        <h4>âŒ ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨</h4>
                        <p>ì˜¤ë¥˜: ${error.message}</p>
                        <p>API URL: ${API_BASE_URL}</p>
                    </div>
                `;
            }
        }

        function runUrlTests() {
            const resultDiv = document.getElementById('url-test-result');
            
            if (!window.testData) {
                resultDiv.innerHTML = '<p>âš ï¸ ë¨¼ì € ë°±ì—”ë“œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì£¼ì„¸ìš”.</p>';
                return;
            }

            let html = '<h4>ğŸ”— URL ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h4>';
            let directLinks = 0;
            let searchLinks = 0;

            window.testData.forEach((item, index) => {
                const originalUrl = item.url;
                const generatedUrl = generateArticleUrl(item);
                const isDirectLink = originalUrl === generatedUrl;
                
                if (isDirectLink) directLinks++;
                else searchLinks++;

                html += `
                    <div class="test-result ${isDirectLink ? 'direct-link' : 'search-link'}">
                        <strong>${index + 1}. ${item.title}</strong><br>
                        <strong>ê¸°ê´€:</strong> ${item.agency}<br>
                        <strong>ê²°ê³¼:</strong> ${isDirectLink ? 'âœ… ì§ì ‘ ë§í¬ ì‚¬ìš©' : 'ğŸ” ê²€ìƒ‰ ë§í¬ ìƒì„±'}<br>
                        <strong>URL:</strong> <a href="${generatedUrl}" target="_blank">${generatedUrl}</a>
                    </div>
                `;
            });

            html += `
                <div class="test-result success">
                    <h4>ğŸ“Š URL ìƒì„± í†µê³„</h4>
                    <p><strong>ì§ì ‘ ë§í¬:</strong> ${directLinks}ê°œ (${((directLinks / window.testData.length) * 100).toFixed(1)}%)</p>
                    <p><strong>ê²€ìƒ‰ ë§í¬:</strong> ${searchLinks}ê°œ (${((searchLinks / window.testData.length) * 100).toFixed(1)}%)</p>
                </div>
            `;

            resultDiv.innerHTML = html;
        }

        function simulateUserClicks() {
            const resultDiv = document.getElementById('user-simulation-result');
            
            if (!window.testData) {
                resultDiv.innerHTML = '<p>âš ï¸ ë¨¼ì € ë°±ì—”ë“œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì£¼ì„¸ìš”.</p>';
                return;
            }

            let html = '<h4>ğŸ‘† ì‚¬ìš©ì í´ë¦­ ì‹œë®¬ë ˆì´ì…˜:</h4>';
            
            // ì •ë¶€ ë³´ë„ìë£Œ ì‹œë®¬ë ˆì´ì…˜
            const govItem = window.testData[0];
            const govUrl = generateArticleUrl(govItem);
            
            html += `
                <div class="test-result">
                    <h5>ğŸ›ï¸ ì •ë¶€ ë³´ë„ìë£Œ ì¹´ë“œ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜</h5>
                    <p><strong>ì‚¬ìš©ì í–‰ë™:</strong> "${govItem.title}" ì¹´ë“œì˜ "ğŸ“– ì›ë¬¸ ë³´ê¸°" ë²„íŠ¼ í´ë¦­</p>
                    <p><strong>ì˜ˆìƒ ê²°ê³¼:</strong> ${govUrl.includes('search.naver.com') ? 'ë„¤ì´ë²„ì—ì„œ ê´€ë ¨ ê¸°ì‚¬ ê²€ìƒ‰' : 'ì •ë¶€ ì‚¬ì´íŠ¸ ì›ë¬¸ í˜ì´ì§€ë¡œ ì´ë™'}</p>
                    <button class="button" onclick="window.open('${govUrl}', '_blank')">ì‹¤ì œ ë§í¬ í…ŒìŠ¤íŠ¸</button>
                </div>
            `;

            // ë¹ ë¥¸ ê²€ìƒ‰ ì‹œë®¬ë ˆì´ì…˜ (ê°€ìƒ ë°ì´í„°)
            const quickArticle = {
                title: "ë””ì§€í„¸ ìì‚° íˆ¬ì ì•ˆì „ ê°€ì´ë“œë¼ì¸ ë°œí‘œ",
                publishedAt: "2024-10-17"
            };
            const quickUrl = generateQuickSearchUrl(quickArticle, "ë””ì§€í„¸ìì‚°");

            html += `
                <div class="test-result">
                    <h5>âš¡ ë¹ ë¥¸ ê²€ìƒ‰ ì¹´ë“œ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜</h5>
                    <p><strong>ì‚¬ìš©ì í–‰ë™:</strong> "ë””ì§€í„¸ìì‚°" ê²€ìƒ‰ ê²°ê³¼ì—ì„œ "ìì„¸íˆ ì½ê¸° â†’" ë²„íŠ¼ í´ë¦­</p>
                    <p><strong>ì˜ˆìƒ ê²°ê³¼:</strong> í•´ë‹¹ ê¸°ì‚¬ì™€ ê´€ë ¨ëœ ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ</p>
                    <button class="button" onclick="window.open('${quickUrl}', '_blank')">ì‹¤ì œ ë§í¬ í…ŒìŠ¤íŠ¸</button>
                </div>
            `;

            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>