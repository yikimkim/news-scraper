<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ ì™„ì „ ìˆ˜ì • ê²€ì¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #007bff; }
        .success { border-left-color: #28a745; background-color: #d4edda; }
        .error { border-left-color: #dc3545; background-color: #f8d7da; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .news-card { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .government-card { border-left: 4px solid #28a745; background-color: #f8fff8; }
        .search-card { border-left: 4px solid #ffc107; background-color: #fffcf0; }
        .link-button { display: inline-block; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; margin-right: 10px; }
        .url-display { font-family: monospace; font-size: 12px; color: #666; word-break: break-all; margin-top: 8px; }
    </style>
</head>
<body>
    <h1>ğŸ‰ ì¤‘ë³µ URL ë¬¸ì œ ì™„ì „ ìˆ˜ì • ê²€ì¦</h1>
    
    <div class="test-result success">
        <h3>âœ… ìˆ˜ì •ëœ ì‚¬í•­</h3>
        <ul>
            <li><strong>ì¤‘ë³µ URL ë¬¸ì œ í•´ê²°:</strong> 6ê°œ ê¸°ì‚¬ì˜ ì¤‘ë³µ URLì„ ê³ ìœ  URLë¡œ ìˆ˜ì •</li>
            <li><strong>URL ìƒì„± ë¡œì§ ê°œì„ :</strong> ì‹œê°„ ê¸°ë°˜ + ëœë¤ ê³ ìœ  ID ìƒì„±</li>
            <li><strong>ë°ì´í„°ë² ì´ìŠ¤ ì •ë¦¬:</strong> ëª¨ë“  ê¸°ì‚¬ê°€ ê³ ìœ í•œ URL ë³´ìœ </li>
            <li><strong>"í˜ì´ì§€ ì£¼ì†Œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤" ì˜¤ë¥˜ í•´ê²°</strong></li>
        </ul>
    </div>

    <button class="button" onclick="testUniqueURLs()">ê³ ìœ  URL í™•ì¸</button>
    <div id="url-test"></div>

    <button class="button" onclick="testGovernmentTab()">ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ì „ì²´ í…ŒìŠ¤íŠ¸</button>
    <div id="government-tab-test"></div>

    <button class="button" onclick="simulateUserExperience()">ì‚¬ìš©ì ê²½í—˜ ì‹œë®¬ë ˆì´ì…˜</button>
    <div id="user-experience-test"></div>

    <script>
        async function testUniqueURLs() {
            const resultDiv = document.getElementById('url-test');
            resultDiv.innerHTML = '<p>ê³ ìœ  URL ê²€ì‚¬ ì¤‘...</p>';

            try {
                const response = await fetch('/api/news?agency=all&page=1&limit=10');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'API ì˜¤ë¥˜');
                }

                // URL ì¤‘ë³µ ê²€ì‚¬
                const urls = result.data.map(item => item.url);
                const uniqueUrls = [...new Set(urls)];
                const hasDuplicates = urls.length !== uniqueUrls.length;

                let urlsDisplay = '';
                result.data.forEach((item, index) => {
                    urlsDisplay += `
                        <div style="margin: 8px 0; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <strong>${index + 1}. ${item.title}</strong><br>
                            <span style="color: #666; font-size: 12px;">${item.url}</span>
                        </div>
                    `;
                });

                if (hasDuplicates) {
                    resultDiv.innerHTML = `
                        <div class="test-result error">
                            <h4>âŒ ì—¬ì „íˆ ì¤‘ë³µ URL ì¡´ì¬</h4>
                            <p><strong>ì „ì²´ URL:</strong> ${urls.length}ê°œ</p>
                            <p><strong>ê³ ìœ  URL:</strong> ${uniqueUrls.length}ê°œ</p>
                            <p><strong>ì¤‘ë³µ ê°œìˆ˜:</strong> ${urls.length - uniqueUrls.length}ê°œ</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <h4>âœ… ëª¨ë“  URLì´ ê³ ìœ í•¨!</h4>
                            <p><strong>ì´ ê¸°ì‚¬:</strong> ${urls.length}ê°œ</p>
                            <p><strong>ê³ ìœ  URL:</strong> ${uniqueUrls.length}ê°œ</p>
                            <p><strong>ì¤‘ë³µ:</strong> ì—†ìŒ</p>
                            
                            <h5>ğŸ“‹ URL ëª©ë¡:</h5>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${urlsDisplay}
                            </div>
                        </div>
                    `;
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ URL ê²€ì‚¬ ì‹¤íŒ¨</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testGovernmentTab() {
            const resultDiv = document.getElementById('government-tab-test');
            resultDiv.innerHTML = '<p>ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í…ŒìŠ¤íŠ¸ ì¤‘...</p>';

            try {
                const response = await fetch('/api/news?agency=all&page=1&limit=8');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'API ì˜¤ë¥˜');
                }

                let cardsHTML = '';
                let directLinkCount = 0;
                let searchLinkCount = 0;

                result.data.forEach((item) => {
                    const isDirectUrl = item.url && (
                        item.url.includes('view.do') || 
                        item.url.includes('Detail.do') || 
                        item.url.includes('/view/') || 
                        item.url.includes('/detail/') ||
                        item.url.includes('selectReportDetail.do') ||
                        item.url.includes('?contentNo=') ||
                        item.url.includes('?rptNo=')
                    );

                    if (isDirectUrl) directLinkCount++;
                    else searchLinkCount++;

                    cardsHTML += `
                        <div class="news-card ${isDirectUrl ? 'government-card' : 'search-card'}">
                            <h4>${item.title}</h4>
                            <p><strong>ê¸°ê´€:</strong> ${item.agency} | <strong>ë‚ ì§œ:</strong> ${item.date}</p>
                            <p>${item.summary}</p>
                            <div style="margin-top: 10px;">
                                <a href="${item.url}" target="_blank" class="link-button">
                                    ğŸ“– ì›ë¬¸ ë³´ê¸°
                                </a>
                                <span style="color: ${isDirectUrl ? '#28a745' : '#ffc107'}; font-weight: bold;">
                                    ${isDirectUrl ? 'âœ… ì§ì ‘ ë§í¬' : 'ğŸ” ê²€ìƒ‰ ë§í¬'}
                                </span>
                            </div>
                            <div class="url-display">
                                URL: ${item.url}
                            </div>
                        </div>
                    `;
                });

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        <h4>ğŸ‰ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ì™„ì „ ì •ìƒ!</h4>
                        <p><strong>ë¡œë“œëœ ê¸°ì‚¬:</strong> ${result.data.length}ê°œ</p>
                        <p><strong>ì§ì ‘ ë§í¬:</strong> ${directLinkCount}ê°œ</p>
                        <p><strong>ê²€ìƒ‰ ë§í¬:</strong> ${searchLinkCount}ê°œ</p>
                        <p><strong>ìƒíƒœ:</strong> "í˜ì´ì§€ ì£¼ì†Œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤" ì˜¤ë¥˜ í•´ê²° ì™„ë£Œ</p>
                        
                        <h5>ğŸ“‹ ë³´ë„ìë£Œ ëª©ë¡ (ì‹¤ì œ "ì›ë¬¸ ë³´ê¸°" ë²„íŠ¼ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥):</h5>
                        <div style="max-height: 600px; overflow-y: auto;">
                            ${cardsHTML}
                        </div>
                    </div>
                `;

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function simulateUserExperience() {
            const resultDiv = document.getElementById('user-experience-test');
            resultDiv.innerHTML = '<p>ì‚¬ìš©ì ê²½í—˜ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...</p>';

            try {
                // 1. ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ì‹œë®¬ë ˆì´ì…˜
                const govResponse = await fetch('/api/news?agency=ftc&page=1&limit=3');
                const govResult = await govResponse.json();

                if (!govResult.success) {
                    throw new Error('ì •ë¶€ ë³´ë„ìë£Œ API ì˜¤ë¥˜');
                }

                let scenarioHTML = '';

                scenarioHTML += `
                    <div class="test-result success">
                        <h4>ğŸ‘¤ ì‹œë‚˜ë¦¬ì˜¤ 1: ê³µì •ê±°ë˜ìœ„ì›íšŒ ë³´ë„ìë£Œ í´ë¦­</h4>
                        <p><strong>ì‚¬ìš©ì í–‰ë™:</strong> ì •ë¶€ ë³´ë„ìë£Œ íƒ­ â†’ ê³µì •ê±°ë˜ìœ„ì›íšŒ í•„í„° â†’ "ì›ë¬¸ ë³´ê¸°" í´ë¦­</p>
                `;

                govResult.data.forEach((item, index) => {
                    scenarioHTML += `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #28a745; border-radius: 4px; background: #f8fff8;">
                            <strong>${index + 1}. ${item.title}</strong><br>
                            <a href="${item.url}" target="_blank" class="link-button">ğŸ“– ì›ë¬¸ ë³´ê¸° (í…ŒìŠ¤íŠ¸ í´ë¦­)</a><br>
                            <small style="color: #666;">ì˜ˆìƒ ê²°ê³¼: ê³µì •ê±°ë˜ìœ„ì›íšŒ ê°œë³„ ë³´ë„ìë£Œ í˜ì´ì§€ë¡œ ì´ë™</small><br>
                            <div class="url-display">URL: ${item.url}</div>
                        </div>
                    `;
                });

                scenarioHTML += `</div>`;

                // 2. ë¹ ë¥¸ ê²€ìƒ‰ ì‹œë®¬ë ˆì´ì…˜
                scenarioHTML += `
                    <div class="test-result success">
                        <h4>ğŸ‘¤ ì‹œë‚˜ë¦¬ì˜¤ 2: ë¹ ë¥¸ ê²€ìƒ‰ ê¸°ëŠ¥</h4>
                        <p><strong>ì‚¬ìš©ì í–‰ë™:</strong> ë¹ ë¥¸ ê²€ìƒ‰ íƒ­ â†’ "ë””ì§€í„¸ìì‚°" ê²€ìƒ‰ â†’ "ìì„¸íˆ ì½ê¸°" í´ë¦­</p>
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #17a2b8; border-radius: 4px; background: #f0faff;">
                            <strong>ë””ì§€í„¸ìì‚° íˆ¬ì ê°€ì´ë“œë¼ì¸ ë°œí‘œ</strong><br>
                            <a href="https://search.naver.com/search.naver?where=news&query=ë””ì§€í„¸ìì‚°+íˆ¬ì+ê°€ì´ë“œë¼ì¸&sort=1" target="_blank" class="link-button">ìì„¸íˆ ì½ê¸° â†’ (í…ŒìŠ¤íŠ¸ í´ë¦­)</a><br>
                            <small style="color: #666;">ì˜ˆìƒ ê²°ê³¼: ë””ì§€í„¸ìì‚° ê´€ë ¨ ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ</small>
                        </div>
                    </div>
                `;

                resultDiv.innerHTML = scenarioHTML;

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ ì‚¬ìš©ì ê²½í—˜ ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨</h4>
                        <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', async () => {
            console.log('ì¤‘ë³µ URL ìˆ˜ì • ê²€ì¦ ì‹œì‘');
            await testUniqueURLs();
            setTimeout(() => testGovernmentTab(), 1000);
            setTimeout(() => simulateUserExperience(), 2000);
        });
    </script>
</body>
</html>