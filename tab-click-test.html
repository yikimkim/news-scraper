<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì œ íƒ­ í´ë¦­ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-frame { border: 2px solid #ccc; margin: 20px 0; }
        .controls { margin: 10px 0; }
        button { margin: 5px; padding: 10px; }
        .result { padding: 10px; background: #f5f5f5; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ì‹¤ì œ íƒ­ í´ë¦­ ë™ì‘ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="controls">
        <button onclick="loadMainSite()">ë©”ì¸ ì‚¬ì´íŠ¸ ë¡œë“œ</button>
        <button onclick="clickBoardsTab()">ë‚´ ê²Œì‹œíŒ íƒ­ í´ë¦­</button>
        <button onclick="clickGovernmentTab()">ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í´ë¦­</button>
        <button onclick="checkCurrentTab()">í˜„ì¬ í™œì„± íƒ­ í™•ì¸</button>
    </div>
    
    <div class="result" id="test-result"></div>
    
    <div class="test-frame">
        <iframe id="main-frame" width="100%" height="600px" src="about:blank"></iframe>
    </div>

    <script>
        const mainUrl = window.location.origin + '/';
        let frame = null;

        function loadMainSite() {
            frame = document.getElementById('main-frame');
            frame.src = mainUrl;
            
            frame.onload = () => {
                updateResult('âœ… ë©”ì¸ ì‚¬ì´íŠ¸ ë¡œë“œ ì™„ë£Œ');
                
                // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ DOM ë¡œë”© ì™„ë£Œ ëŒ€ê¸°
                setTimeout(() => {
                    checkFrameReady();
                }, 3000);
            };
        }

        function checkFrameReady() {
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                const navTabs = frameDoc.querySelector('.nav-tabs');
                const boardsTab = frameDoc.querySelector('[onclick*="boards"]');
                const governmentTab = frameDoc.querySelector('[onclick*="government"]');
                
                updateResult(`
                    DOM í™•ì¸:<br>
                    â€¢ nav-tabs: ${navTabs ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>
                    â€¢ ë‚´ ê²Œì‹œíŒ íƒ­: ${boardsTab ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>
                    â€¢ ì •ë¶€ ë³´ë„ìë£Œ íƒ­: ${governmentTab ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>
                    ${boardsTab ? `â€¢ ë‚´ ê²Œì‹œíŒ íƒ­ í…ìŠ¤íŠ¸: "${boardsTab.textContent.trim()}"` : ''}<br>
                    ${governmentTab ? `â€¢ ì •ë¶€ íƒ­ í…ìŠ¤íŠ¸: "${governmentTab.textContent.trim()}"` : ''}
                `);
            } catch (error) {
                updateResult(`âŒ í”„ë ˆì„ ì ‘ê·¼ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        function clickBoardsTab() {
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                const frameWindow = frame.contentWindow;
                
                // ë‚´ ê²Œì‹œíŒ íƒ­ ì°¾ê¸°
                const boardsTab = frameDoc.querySelector('[onclick*="boards"]');
                
                if (!boardsTab) {
                    updateResult('âŒ ë‚´ ê²Œì‹œíŒ íƒ­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                updateResult('ğŸ”„ ë‚´ ê²Œì‹œíŒ íƒ­ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...');
                
                // í´ë¦­ ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                boardsTab.click();
                
                // 1ì´ˆ í›„ ê²°ê³¼ í™•ì¸
                setTimeout(() => {
                    checkTabState(frameDoc, 'boards-tab', 'ë‚´ ê²Œì‹œíŒ');
                }, 1000);
                
            } catch (error) {
                updateResult(`âŒ ë‚´ ê²Œì‹œíŒ íƒ­ í´ë¦­ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        function clickGovernmentTab() {
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                const frameWindow = frame.contentWindow;
                
                // ì •ë¶€ ë³´ë„ìë£Œ íƒ­ ì°¾ê¸°
                const governmentTab = frameDoc.querySelector('[onclick*="government"]');
                
                if (!governmentTab) {
                    updateResult('âŒ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                updateResult('ğŸ”„ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...');
                
                // í´ë¦­ ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                governmentTab.click();
                
                // 3ì´ˆ í›„ ê²°ê³¼ í™•ì¸ (API í˜¸ì¶œ ì‹œê°„ ê³ ë ¤)
                setTimeout(() => {
                    checkTabState(frameDoc, 'government-tab', 'ì •ë¶€ ë³´ë„ìë£Œ');
                }, 3000);
                
            } catch (error) {
                updateResult(`âŒ ì •ë¶€ ë³´ë„ìë£Œ íƒ­ í´ë¦­ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        function checkTabState(frameDoc, tabId, tabName) {
            try {
                const targetTab = frameDoc.getElementById(tabId);
                const activeTab = frameDoc.querySelector('.nav-tab.active');
                const activeContent = frameDoc.querySelector('.tab-content.active');
                
                if (!targetTab) {
                    updateResult(`âŒ ${tabName} ì»¨í…ì¸  ìš”ì†Œ(${tabId})ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                    return;
                }
                
                const computedStyle = frameDoc.defaultView.getComputedStyle(targetTab);
                const isVisible = computedStyle.display !== 'none' && targetTab.classList.contains('active');
                
                updateResult(`
                    ${tabName} íƒ­ ìƒíƒœ í™•ì¸:<br>
                    â€¢ íƒ­ ì»¨í…ì¸  ì¡´ì¬: ${targetTab ? 'âœ…' : 'âŒ'}<br>
                    â€¢ active í´ë˜ìŠ¤: ${targetTab.classList.contains('active') ? 'âœ…' : 'âŒ'}<br>
                    â€¢ display ì†ì„±: ${computedStyle.display}<br>
                    â€¢ visibility ì†ì„±: ${computedStyle.visibility}<br>
                    â€¢ opacity ì†ì„±: ${computedStyle.opacity}<br>
                    â€¢ ì‹¤ì œ í‘œì‹œ ì—¬ë¶€: ${isVisible ? 'âœ… í‘œì‹œë¨' : 'âŒ ìˆ¨ê²¨ì§'}<br>
                    â€¢ í™œì„± íƒ­ ë²„íŠ¼: ${activeTab ? activeTab.textContent.trim() : 'ì—†ìŒ'}<br>
                    â€¢ í™œì„± ì»¨í…ì¸ : ${activeContent ? activeContent.id : 'ì—†ìŒ'}
                `);
                
                // ì»¨í…ì¸  ë‚´ìš©ë„ í™•ì¸
                if (isVisible) {
                    const contentText = targetTab.textContent.substring(0, 200);
                    updateResult(`ğŸ“„ ì»¨í…ì¸  ë‚´ìš© (ì²˜ìŒ 200ì):<br>${contentText}...`);
                }
                
            } catch (error) {
                updateResult(`âŒ íƒ­ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        function checkCurrentTab() {
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                const activeTab = frameDoc.querySelector('.nav-tab.active');
                const activeContent = frameDoc.querySelector('.tab-content.active');
                const allTabs = frameDoc.querySelectorAll('.nav-tab');
                const allContents = frameDoc.querySelectorAll('.tab-content');
                
                let tabStatus = '';
                allTabs.forEach((tab, index) => {
                    tabStatus += `${index + 1}. ${tab.textContent.trim()}: ${tab.classList.contains('active') ? 'ğŸŸ¢ í™œì„±' : 'âšª ë¹„í™œì„±'}<br>`;
                });
                
                let contentStatus = '';
                allContents.forEach((content, index) => {
                    const style = frameDoc.defaultView.getComputedStyle(content);
                    const isVisible = style.display !== 'none' && content.classList.contains('active');
                    contentStatus += `${index + 1}. ${content.id}: ${isVisible ? 'ğŸŸ¢ í‘œì‹œ' : 'âšª ìˆ¨ê¹€'}<br>`;
                });
                
                updateResult(`
                    í˜„ì¬ íƒ­ ìƒíƒœ:<br>
                    <strong>íƒ­ ë²„íŠ¼ë“¤:</strong><br>${tabStatus}<br>
                    <strong>íƒ­ ì»¨í…ì¸ ë“¤:</strong><br>${contentStatus}
                `);
                
            } catch (error) {
                updateResult(`âŒ í˜„ì¬ íƒ­ í™•ì¸ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        function updateResult(message) {
            const result = document.getElementById('test-result');
            const timestamp = new Date().toLocaleTimeString();
            result.innerHTML = `[${timestamp}] ${message}`;
        }

        // ìë™ ì‹œì‘
        window.addEventListener('load', () => {
            updateResult('í…ŒìŠ¤íŠ¸ ì¤€ë¹„ë¨. "ë©”ì¸ ì‚¬ì´íŠ¸ ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
        });
    </script>
</body>
</html>